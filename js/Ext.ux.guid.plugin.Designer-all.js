Ext.isVersion=function(C,F){if(C instanceof Array){F=formVersion[1];C=formVersion[0]}var A=function(G){var H=G.match(/^(\d)\.\d/);H=H?H[1]:0;var J=G.match(/^\d\.(\d)/);J=J?J[1]:0;var I=G.match(/^\d\.\d\.(\d)/);I=I?I[1]:0;return(H*1)+(J*0.1)+(I*0.001)};var D=A(C||Ext.version);var B=A(F||Ext.version);var E=A(Ext.version);return(E>=D&&E<=B)};Ext.overrideIf=function(A,C,B,D){if(Ext.isVersion(B,D)){return Ext.override(A,C)}return A};Ext.applyVersion=function(B,C,A,D){if(Ext.isVersion(A,D)){return Ext.apply(B,C)}return B};Ext.applyIfVersion=function(B,C,A,D){if(Ext.isVersion(A,D)){return Ext.applyIf(B,C)}return B};Ext.overrideIf(Ext.Panel,{getKeyMap:function(){if(!this.keyMap){if(Ext.isArray(this.keys)){for(var B=0,A=this.keys.length;B<A;B++){this.keys[B].scope=this.keys[B].scope||this}}else{if(this.keys&&!this.keys.scope){this.keys.scope=this}}this.keyMap=new Ext.KeyMap(this.el,this.keys)}return this.keyMap}},"2.0");Ext.overrideIf(Ext.FormPanel,{initFields:function(){this.initItems();var C=this.form;var A=this;var B=function(D){if(D.doLayout&&D!=A){Ext.applyIf(D,{labelAlign:D.ownerCt.labelAlign,labelWidth:D.ownerCt.labelWidth,itemCls:D.ownerCt.itemCls});if(D.items){D.items.each(B)}}else{if(D.isFormField){C.add(D)}}};this.items.each(B)}},"2.0");Ext.overrideIf(Ext.Button,{setTooltip:function(A){var B=this.getEl().child(this.buttonSelector);Ext.QuickTips.register({target:B.id,text:A})}},"2.0");Ext.applyIfVersion(Ext,{isGecko3:!Ext.isSafari&&navigator.userAgent.toLowerCase().indexOf("rv:1.9")>-1},"2.0","2.2");Ext.ComponentMgr=function(A){var C={};function B(G,D){if(!G||!D){return }for(var F=D.split(","),E=0;E<F.length;E++){C[F[E]]=F[E]}}B(Ext.isVersion("2.0"),"box,button,colorpalette,component,container,cycle,dataview,datepicker,editor,editorgrid,grid,paging,panel,progress,propertygrid,splitbutton,tabpanel,treepanel,viewport,window,toolbar,tbbutton,tbfill,tbitem,tbseparator,tbspacer,tbsplit,tbtext,form,checkbox,combo,datefield,field,fieldset,hidden,htmleditor,label,numberfield,radio,textarea,textfield,timefield,trigger");B(Ext.isVersion("2.1"),"slider,statusbar");return Ext.applyIf({registerType:function(E,D){A.registerType(E,D);C[E]=E},isTypeAvailable:function(D){return !!C[D]},allTypes:function(){var D=[];for(var E in C){D.push(E)}return D}},A)}(Ext.ComponentMgr);Ext.reg=Ext.ComponentMgr.registerType;Ext.namespace("Ext.ux.form");Ext.ux.form.SimpleCombo=Ext.extend(Ext.form.ComboBox,{mode:"local",triggerAction:"all",typeAhead:true,valueField:"value",displayField:"name",forceSelection:true,editable:true,minChars:0,customProperties:false,initComponent:function(){Ext.ux.form.SimpleCombo.superclass.initComponent.call(this);if(!this.store&&this.data){this.store=new Ext.data.SimpleStore({fields:["value","name","cls"],data:this.data})}this.tpl='<tpl for="."><div class="x-combo-list-item {cls}">{'+this.displayField+"}</div></tpl>"},setList:function(B){data=[];if(B){for(var A=0;A<B.length;A++){data.push([B[A],B[A],null])}}this.store.loadData(data,false)},getValue:function(){var A=Ext.ux.form.SimpleCombo.superclass.getValue.call(this)||"";var B=this.getRawValue()||"";if(!this.customProperties||A.toLowerCase().indexOf(B.toLowerCase())==0){return A}return B}});Ext.reg("simplecombo",Ext.ux.form.SimpleCombo);Ext.ux.IFrameComponent=Ext.extend(Ext.BoxComponent,{onRender:function(C,A){var B=this.url;B+=(B.indexOf("?")!=-1?"&":"?")+"_dc="+(new Date().getTime());this.el=C.createChild({tag:"iframe",id:"iframe-"+this.id,frameBorder:0,src:B})}});Ext.reg("iframe",Ext.ux.IFrameComponent);Ext.ux.Json=Ext.extend(Ext.ux.Util,{indentString:"  ",readable:true,licenseText:null,jsonId:null,scope:{},evalException:true,fullEncode:false,initialize:function(){Ext.ux.Json.superclass.initialize.call(this);this.addEvents({beforeapply:true,afterapply:true})},getScope:function(){return this.scope},isEmpty:function(B){if(B instanceof Array){for(var A=0;A<B.length;A++){if(!this.isEmpty(B[A])){return false}}}else{if(typeof (B)=="object"){for(var A in B){if((!this.useHasOwn||B.hasOwnProperty(A))&&(!this.jsonId||A.indexOf(this.jsonId)!=0)){return false}}}else{if(typeof (B)!="undefined"){return false}}}return true},load:function(A,B){if(B&&B instanceof Ext.Container){return this.load(A,function(C){this.apply(B,C)}.createDelegate(this))}else{if(typeof (B)=="function"){Ext.Ajax.request({url:A,callback:function(E,G,D){try{if(G){var C=this.decode(D.responseText);if(typeof callback=="function"){B(C)}}else{throw new Error("Failure during load")}}catch(F){this.fireEvent("error","load",F)}},scope:this});return null}else{return this.decode((typeof (A)=="object")?this.syncContent(A.url,A.disableChaching):this.syncContent(A.url,false))}}},set:function(G,K,L){var B=true,C=G||this;L=L||{};if(K){if(typeof (K)=="string"){K=this.decode(K,L)}for(var H in K){var F=H;if(H=="required_js"){if(K[H]){var A=K[H].split(";");for(var I=0;I<A.length;I++){if(document.getElementById(A[I])){continue}if(!this.scriptLoader(A[I],false)){var J=new Error("Failed to load javascript "+A[I]);if(this.fireEvent("error","set",J)){throw J}}}}}else{if(H=="required_css"){if(K[H]){var A=K[H].split(";");for(var I=0;I<A.length;I++){if(document.getElementById(A[I])){continue}Ext.util.CSS.swapStyleSheet(A[I],A[I])}}}else{var D=C;if(H.indexOf("scope.")==0){D=L.scope?L.scope:this.getScope();F=H.substring(6);if(F.charAt(0)=="!"){F=F.substring(1);if(D[F]){continue}}}else{if(L.scopeOnly){continue}}var E="set"+F.substring(0,1).toUpperCase()+F.substring(1);try{if(D[E]&&typeof D[E]=="function"){D[E].call(C,K[H])}else{if(D[F]&&typeof D[F]=="function"){D[F].call(C,K[H])}else{D[F]=K[H]}}}catch(J){B|=(this.fireEvent("error","set",J)===false)}}}}}return B},clean:function(C){var G=0;for(var B in C){if(!this.useHasOwn||C.hasOwnProperty(B)){if(B=="items"){if(C[B] instanceof Array){var F=[];for(var D=0,A=C[B];D<A.length;D++){var E=this.clean(A[D]);if(E!=null){F.push(E)}}C[B]=(F.length>0)?F:null}else{C[B]=this.clean(C[B])}}if(C[B]===null){delete C[B]}else{G++}}}return G?C:null},editable:function(C){var A=C||{};if(typeof (A)!=="object"){A=this.decode(C)}if(!this.jsonId){return A}if(A instanceof Array){for(var B=0;B<A.length;B++){A[B]=this.editable(A[B])}return A}if(!A[this.jsonId]){A[this.jsonId]=Ext.id();if(A.items){A.items=this.editable(A.items)}}return A},merge:function(C,B){if(C instanceof Array&&B instanceof Array){var A=[];for(var D=0;D<C.length;D++){A.push(C[D])}for(var D=0;D<B.length;D++){A.push(B[D])}return A}else{if(typeof (C)==typeof (B)&&typeof (C)=="object"){var E={};for(var D in C){E[D]=this.merge(C[D],B[D])}for(var D in B){if(!E[D]){E[D]=B[D]}}return E}else{if(typeof (C)==typeof (B)){return B}else{if(typeof (C)=="undefined"){return B}else{if(typeof (B)=="undefined"){return C}else{throw new SyntaxError("Object items cannot be joined because items mismatch")}}}}}},apply:function(D,C,B){var A;try{A=this.jsonId?this.editable(C):C||{};if(typeof (A)!=="object"){A=this.decode(C)}if(A){if(B!==false){A=this.clean(A)}this.fireEvent("beforeapply",D,A);if(D instanceof Ext.Container){while(D.items&&D.items.first()){D.remove(D.items.first(),true)}if(!this.isEmpty(A)){if(A instanceof Array){D.add.apply(D,A)}else{D.add(A)}this.set(D,A.json)}}else{this.set(D,A)}}if(D.rendered&&D.layout&&D.layout.layout){D.doLayout()}}catch(E){if(this.fireEvent("error","apply",E)){throw E}}finally{this.fireEvent("afterapply",D,A)}return A},encodeString:function(B){var A={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(B)){return'"'+B.replace(/([\x00-\x1f\\"])/g,function(D,C){var E=A[C];if(E){return E}E=C.charCodeAt();return"\\u00"+Math.floor(E/16).toString(16)+(E%16).toString(16)})+'"'}return'"'+B+'"'},indentStr:function(C){var B="",A=0;while(this.readable&&A<C){B+=this.indentString;A++}return B},encodeArray:function(G,B,H){B=B||0;var D=["["],A,F,C=G.length,E;for(var F=0;F<C;F+=1){E=G[F];switch(typeof E){case"undefined":case"unknown":break;default:if(A){D.push(",")}D.push(E===null?"null":this.encode(E,B+1,H));A=true}}D.push("]");return D.join("")},encodeDate:function(B){var A=function(C){return C<10?"0"+C:C};return'"'+B.getFullYear()+"-"+A(B.getMonth()+1)+"-"+A(B.getDate())+"T"+A(B.getHours())+":"+A(B.getMinutes())+":"+A(B.getSeconds())+'"'},encode:function(D,E,C,H){var A=this.readable?"\n":"";var G=this.readable?" : ":"";E=E||0;if(typeof D=="undefined"||D===null){return"null"}else{if(D instanceof Array){return this.encodeArray(D,E,C)}else{if(D instanceof Date){return this.encodeDate(D)}else{if(typeof D=="number"){return isFinite(D)?String(D):"null"}else{if(typeof D=="string"&&!isNaN(D)&&D!=""){return D}else{if(typeof D=="string"&&["true","false"].indexOf(D)!=-1){return D}else{if(typeof D=="boolean"){return String(D)}else{if(typeof D=="string"){return this.encodeString(D)}else{var J=[],I,F,K;if(E==0&&!H){if(this.licenseText){J.push(this.licenseText+"\n")}}J.push("{"+A);for(var F in D){K=D[F];var B=(F.indexOf(this.jsonId)==0&&F!=this.jsonId)?F.substring(this.jsonId.length):null;if((!B&&this.jsonId&&D[this.jsonId+F])||(!C&&F==this.jsonId)){continue}if(B){if(I){J.push(","+A)}if(typeof (K)=="object"){if(K.encode===false){J.push(this.indentStr(E),B,G,K.value)}else{J.push(this.indentStr(E),B,G,this.encode(K.value,E+1,C))}}else{J.push(this.indentStr(E),B,G,K)}I=true}else{if(!this.useHasOwn||D.hasOwnProperty(F)){switch(typeof K){case"undefined":case"unknown":break;case"function":if(I){J.push(","+A)}J.push(this.indentStr(E),F,G,""+K);I=true;break;case"object":case"string":if(!K){break}default:if(I){J.push(","+A)}J.push(this.indentStr(E),F,G,K===null?"null":this.encode(K,E+1,C));I=true}}}}J.push(A+this.indentStr(E-1)+"}");return J.join("")}}}}}}}}},getObjectRawValue:function(B,C){if(this.jsonId&&B[this.jsonId+C]){var A=B[this.jsonId+C];return typeof (A)=="object"?A.value:A}return B[C]},setObjectValue:function(A,B,E,D,C){C=C||this.getScope();if(B=="json"){this.set(C,E,{scopeOnly:true,scope:C})}if(E===null){delete A[B];delete A[this.jsonId+B];return E}A[B]=E;if(D&&this.jsonId){A[this.jsonId+B]=D}else{if(!D&&this.jsonId){delete A[this.jsonId+B]}}return E},codeEval:function(code,options){options=options||{};var self=this;var scope=options.scope||this.getScope();var evalException=typeof (options.evalException)=="undefined"?this.evalException:options.evalException;var myEval=function(code){try{return eval("({fix:"+code+"})").fix}catch(e){e=new SyntaxError("Invalid code: "+code+" ("+e+")");if(self.fireEvent("error","codeEval",e)&&evalException){throw e}return code}}.createDelegate(scope);return myEval(code)},decode:function(T,E){E=E||{};var K=0,J=" ",M=this;var C=E.scope||this.getScope();var U=typeof (E.fullDecode)=="undefined"?this.fullDecode:E.fullDecode;function R(W){var X=new SyntaxError(W);X.at=K-1;X.json=T;throw X}function O(){J=T.charAt(K);K+=1;return J}function N(W){K-=W?W:1;J=T.charAt(K);K+=1;return J}function P(X,Y){if(typeof (Y)=="undefined"){Y=-1}var W=0;for(;W<X.length&&T.charAt(K+W+Y)==X.charAt(W);W++){}if(W>=X.length){K+=Y+W;O();return true}return false}function F(){while(J){if(J<=" "){O()}else{if(J=="/"){switch(O()){case"/":while(O()&&J!="\n"&&J!="\r"){}break;case"*":O();for(;;){if(J){if(J=="*"){if(O()=="/"){O();break}}else{O()}}else{R("Unterminated comment")}}break;default:N(2);return }}else{break}}}}function H(){var W=J;while(O()&&": \t\n\r.-+={(}[])'\"".indexOf(J)==-1){W+=J}return W}function A(a){a=a||J;var b=K-1,Y,Z="",X,W;if(J==a){outer:while(O()){if(J==a){O();return Z}else{if(J=="\\"){switch(O()){case"b":Z+="\b";break;case"f":Z+="\f";break;case"n":Z+="\n";break;case"r":Z+="\r";break;case"t":Z+="\t";break;case"u":W=0;for(Y=0;Y<4;Y+=1){X=parseInt(O(),16);if(!isFinite(X)){break outer}W=W*16+X}Z+=String.fromCharCode(W);break;default:Z+=J}}else{Z+=J}}}}R("Bad string "+T.substring(b,K-1))}function G(X){var Y=K-1,W=[];if(J=="["){O();F();if(J=="]"){O();return W}while(J){W.push(Q(X)[0]);F();if(J=="]"){O();return W}else{if(J!=","){break}}O();F()}}R("Bad array "+T.substring(Y,K-1))}function V(Y){var a=K-1,X,Z={},W;if(J=="{"){O();F();if(J=="}"){O();return Z}while(J){X=J=='"'||J=="'"?A():H();F();if(J!=":"){R("Bad key("+J+") seprator for object "+T)}O();F();W=Q(X!="items");M.setObjectValue(Z,X,W[0],W[1],C);F();if(J=="}"){O();return Z}else{if(J!=","){break}}O();F()}}R("Bad object ["+X+"]"+T.substring(a,K-1))}function D(){var X="",W;if(J=="-"){X="-";O()}while(J>="0"&&J<="9"){X+=J;O()}if(J=="."){X+=".";while(O()&&J>="0"&&J<="9"){X+=J}}if(J=="e"||J=="E"){X+="e";O();if(J=="-"||J=="+"){X+=J;O()}while(J>="0"&&J<="9"){X+=J;O()}}W=+X;if(!isFinite(W)){R("Bad number "+W)}else{return W}}function L(W){while(O()){F();switch(J){case W:return ;case"(":L(")");break;case"[":L("]");break;case"{":L("}");break;case'"':case"'":A(J);K--}}R("Unexpected end of code")}function B(){K--;var Y=K;var W;while(O()){W=K;F();switch(J){case"(":L(")");break;case"[":L("]");break;case"{":L("}");break;case'"':case"'":A(J);break;case",":case"]":case"}":var X=T.substring(Y,W-1);return[M.codeEval(X,E),X]}}R("Unexpected end of code")}function Q(W){lastCode=null;F();switch(J){case"{":return W&&!U?B():[V(false)];case"[":return W&&!U?B():[G(false)];case'"':case"'":return[A(J)];default:if(P("true")){return[true]}else{if(P("false")){return[false]}else{if(P("null")){return[null]}else{if("-.0123456789".indexOf(J)>=0){return[D()]}}}}return B()}}try{if(!T){return null}var I=Q(false)[0];F();if(J){R("Invalid Json")}if(this.jsonId){I=this.editable(I)}return I}catch(S){if(this.fireEvent("error","decode",S)){throw S}}},clone:function(A){return this.decode(this.encode(A))}});Ext.ux.JSON=new Ext.ux.Json({jsonId:"__JSON__",licenseText:"/* This file is created or modified by Ext.ux.Json */"});Ext.ux.JsonPanel=Ext.extend(Ext.Panel,{layout:"fit",border:false,single:true,json:null,initComponent:function(){if(this.autoLoad){if(typeof this.autoLoad!=="object"){this.autoLoad={url:this.autoLoad}}if(typeof this.autoLoad.nocache=="undefined"){this.autoLoad.nocache=this.disableCaching}}Ext.ux.JsonPanel.superclass.initComponent.call(this);this.json=new Ext.ux.Json({scope:this.scope||this});this.addEvents({beforejsonload:true,afterjsonload:true,failedjsonload:false})},onRender:function(C,A){Ext.ux.JsonPanel.superclass.onRender.call(this,C,A);var B=this.getUpdater();B.showLoadIndicator=false;B.on("failure",function(E,D){if(this.ownerCt){this.ownerCt.el.unmask()}this.fireEvent("failedjsonload",D)}.createDelegate(this));B.on("beforeupdate",function(E,D,F){if(this.loadMask&&this.ownerCt){this.ownerCt.el.mask(this.loadMsg,this.msgCls)}}.createDelegate(this));B.setRenderer({render:function(E,D,G,H){this.fireEvent("beforejsonload",D);try{this.json.apply(this,D.responseText);this.fireEvent("afterjsonload");this.ownerCt.el.unmask();if(H){H()}}catch(F){this.ownerCt.el.unmask();if(!this.fireEvent("afterjsonload",D,F)){Ext.Msg.alert("Failure","Failed to decode load Json:"+F)}}}.createDelegate(this)})}});Ext.reg("jsonpanel",Ext.ux.JsonPanel);Ext.ux.JsonWindow=Ext.extend(Ext.Window,{layout:"fit",border:false,single:true,json:null,initComponent:function(){if(this.autoLoad){if(typeof this.autoLoad!=="object"){this.autoLoad={url:this.autoLoad}}if(typeof this.autoLoad.nocache=="undefined"){this.autoLoad.nocache=this.disableCaching}}this.json=new Ext.ux.Json({scope:this.scope||this});this.addEvents({beforejsonload:true,afterjsonload:true,failedjsonload:false});Ext.ux.JsonWindow.superclass.initComponent.call(this)},setX:function(A){this.setPosition(A,this.y)},setY:function(A){this.setPosition(this.x,A)},setAlignTo:function(A){this.alignTo(A[0],A[1],A[2])},setAnchorTo:function(A){this.anchorTo(A[0],A[1],A[2],A[3])},onRender:function(C,A){Ext.ux.JsonWindow.superclass.onRender.call(this,C,A);var B=this.getUpdater();B.showLoadIndicator=false;B.on("failure",function(E,D){if(this.ownerCt){this.ownerCt.el.unmask()}this.fireEvent("failedjsonload",D)}.createDelegate(this));B.on("beforeupdate",function(E,D,F){if(this.loadMask&&this.ownerCt){this.ownerCt.el.mask(this.loadMsg,this.msgCls)}}.createDelegate(this));B.setRenderer({render:function(E,D,G,H){this.fireEvent("beforejsonload",D);try{this.json.apply(this,D.responseText);this.fireEvent("afterjsonload");if(H){H()}}catch(F){if(this.fireEvent("failedjsonload",D,F)!==true){Ext.Msg.alert("Failure","Failed to decode load Json:"+F)}}}.createDelegate(this)})}});Ext.reg("jsonwindow",Ext.ux.JsonWindow);Ext.namespace("Ext.ux.form");Ext.ux.form.ScriptEditor=Ext.extend(Ext.BoxComponent,{value:undefined,language:"javascript",codePress:true,setValue:function(A){this.value=A},getValue:function(){return this.value||""},isValid:function(A){return true},onTriggerClick:function(){if(this.disabled){return }if(!this.editorWin){var A=(this.codePress&&Ext.ux.CodePress)?new Ext.ux.CodePress({language:this.language,autoResize:true,trim:true}):new Ext.form.TextArea({resize:Ext.emptyFn});this.editorWin=new Ext.Window({title:"ScriptEditor",iconCls:"icon-editEl",closable:true,width:600,height:450,plain:true,modal:true,maximizable:true,layout:"fit",items:A,closeAction:"hide",keys:[{key:27,scope:this,fn:function(){this.editorWin.hide();Ext.getCmp(this.editor).cancelEdit()}}],buttons:[{text:"Close",scope:this,handler:function(){this.editorWin.hide();Ext.getCmp(this.editor).cancelEdit()}},{text:"Apply",scope:this,handler:function(){this.setValue(A.getValue());this.editorWin.hide();this.editorWin.el.unmask();Ext.getCmp(this.editor).completeEdit()}}]});this.editorWin.tf=A;this.editorWin.doLayout();this.editorWin.on("resize",function(){A.resize()})}this.editorWin.show();this.editorWin.tf.setValue(this.value||this.defaultValue)},onRender:function(B,A){this.editor=B.id;Ext.ux.form.ScriptEditor.superclass.onRender.call(this,B,A);this.el=B.createChild({tag:"div",cls:"x-form-text"},A);this.trigger=this.el.createChild({tag:"div"});this.trigger.createChild({tag:"div",cls:"icon-scripteditor",html:"&nbsp;"});this.trigger.createChild({tag:"div",cls:"text-scripteditor",html:"Click to edit"});this.trigger.on("click",this.onTriggerClick,this,{preventDefault:true})}});Ext.reg("scripteditor",Ext.ux.form.ScriptEditor);Ext.namespace("Ext.ux.data");Ext.ux.data.HttpMergeProxy=function(A){Ext.ux.data.HttpMergeProxy.superclass.constructor.call(this);this.urlArray=A||[];this.urlData=[]};Ext.extend(Ext.ux.data.HttpMergeProxy,Ext.data.DataProxy,{merge:function(C,B){if(C instanceof Array&&B instanceof Array){var A=[];for(var D=0;D<C.length;D++){A.push(C[D])}for(var D=0;D<B.length;D++){A.push(B[D])}return A}else{if(typeof (C)==typeof (B)&&typeof (C)=="object"){var E={};for(var D in C){E[D]=this.merge(C[D],B[D])}for(var D in B){if(!E[D]){E[D]=B[D]}}return E}else{if(typeof (C)==typeof (B)&&typeof (C)=="string"){return C+B}else{if(typeof (C)==typeof (B)){return B}else{if(typeof (C)=="undefined"){return B}else{if(typeof (B)=="undefined"){return C}else{throw new SyntaxError("Object items cannot be joined because items mismatch")}}}}}}},load:function(F,B,G,D,A){if(this.fireEvent("beforeload",this,F)!==false){this.count=this.urlArray.length;this.urlData=[];for(var C=0;C<this.urlArray.length;C++){var E={params:F||{},request:{callback:G,scope:D,arg:A},reader:B,callback:this.loadResponse,scope:this};E=Ext.apply(E,typeof (this.urlArray[C])=="object"?this.urlArray[C]:{url:this.urlArray[C]});E.urlArrayId=C;Ext.Ajax.request(E)}}else{G.call(D||this,null,A,false)}},loadResponse:function(F,E,B){if(this.count<=0){return }if(!E){this.count=0;this.fireEvent("loadexception",this,F,B);F.request.callback.call(F.request.scope,null,F.request.arg,false);return }try{this.urlData[F.urlArrayId]=F.reader.read(B)}catch(D){this.count=0;this.fireEvent("loadexception",this,F,B,D);F.request.callback.call(F.request.scope,null,F.request.arg,false);return }this.count--;if((this.count)==0){var A;try{for(var C=0;C<this.urlArray.length;C++){A=this.merge(A,this.urlData[C])}this.fireEvent("load",this,F,F.request.arg);F.request.callback.call(F.request.scope,A,F.request.arg,true)}catch(D){this.count=0;this.fireEvent("loadexception",this,F,B,D);F.request.callback.call(F.request.scope,null,F.request.arg,false);return }}},update:function(A){},updateResponse:function(A){}});Ext.namespace("Ext.ux.guid.tree");Ext.ux.guid.tree.CodeLoader=function(B,A){Ext.apply(this,A);this.designer=B;Ext.tree.TreeLoader.superclass.constructor.call(this)};Ext.extend(Ext.ux.guid.tree.CodeLoader,Ext.util.Observable,{jsonId:"__JSON__",elementToText:function(C){var A=[];C=C||{};if(C[this.jsonId+"xtype"]){var B=C[this.jsonId+"xtype"];A.push(typeof (B)=="object"?B.display||B.value:B)}else{if(C.xtype){A.push(C.xtype)}}if(C.fieldLabel){A.push("["+C.fieldLabel+"]")}if(C.boxLabel){A.push("["+C.boxLabel+"]")}if(C.layout){A.push("<i>"+C.layout+"</i>")}if(C.title){A.push("<b>"+C.title+"</b>")}if(C.text){A.push("<b>"+C.text+"</b>")}if(C.region){A.push("<i>("+C.region+")</i>")}return(A.length==0?"Element":A.join(" "))},load:function(A,B){A.beginUpdate();while(A.firstChild){A.removeChild(A.firstChild)}if(this.doLoad(A,this.designer.getConfig())){if(typeof B=="function"){B()}}A.endUpdate()},doLoad:function(E,F){if(F){if(F instanceof Array){for(var B=0;B<F.length;B++){this.doLoad(E,F[B])}}else{if(!this.designer.isEmpty(F)){var D=this.designer.isContainer(this.designer.findByJsonId(F[this.jsonId]));var C={text:this.elementToText(F),cls:D?"folder":"file",leaf:D?false:true,jsonId:F[this.jsonId]};var G=E.appendChild(new Ext.tree.TreeNode(C));if(F.items){for(var B=0,A=F.items.length;B<A;B++){this.doLoad(G,F.items[B])}}}}}return !!F}});Ext.namespace("Ext.ux.guid.tree");Ext.ux.guid.tree.JsonTreeLoader=Ext.extend(Ext.tree.TreeLoader,{createNode:function(attr){var childeren=attr.childeren;delete attr.childeren;if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}if(this.applyLoader!==false){attr.loader=this}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}if(!childeren){return(attr.leaf===false?new Ext.tree.AsyncTreeNode(attr):new Ext.tree.TreeNode(attr))}else{var node=new Ext.tree.TreeNode(Ext.applyIf(attr,{draggable:false}));for(var i=0,len=childeren.length;i<len;i++){if(Ext.isVersion(childeren[i].isVersion)){var n=this.createNode(childeren[i]);if(n){node.appendChild(n)}}}return node}},requestData:function(B,D){if(this.dataUrl instanceof Array){var C=this.dataUrl;for(var A=0;A<C.length;A++){this.dataUrl=C[A];Ext.ux.guid.tree.JsonTreeLoader.superclass.requestData.call(this,B,D)}this.dataUrl=C}else{Ext.ux.guid.tree.JsonTreeLoader.superclass.requestData.call(this,B,D)}}});Ext.namespace("Ext.ux.guid.grid");Ext.ux.guid.grid.PropertyRecord=Ext.data.Record.create([{name:"name",type:"string"},"value","type"]);Ext.ux.guid.grid.PropertyStore=function(A,B){Ext.ux.guid.grid.PropertyStore.superclass.constructor.call(this,A,B);this.store=new Ext.data.Store({recordType:Ext.ux.guid.grid.PropertyRecord});this.store.on("update",this.onUpdate,this)};Ext.ux.guid.grid.PropertyStore=Ext.extend(Ext.grid.PropertyStore,{jsonId:"__JSON__",getPropertyType:function(A){if(this.grid&&this.grid.getPropertyType){return this.grid.getPropertyType(A)}return null},setSource:function(E){this.source=E;this.store.removeAll();var D=[];for(var B in E){if(B.indexOf(this.jsonId)!=0&&["items"].indexOf(B)==-1){var A=E[this.jsonId+B];var C=null;if(typeof (A)=="object"){C=A.type||C;A=A.display||A.value}if(typeof (E[B])=="function"){D.push(new Ext.grid.PropertyRecord({name:B,value:A||String(E[B]),type:"function"},B))}else{if(typeof (E[B])=="object"){D.push(new Ext.grid.PropertyRecord({name:B,value:A||String(Ext.ux.JSON.encode(E[B])),type:"object"},B))}}D.push(new Ext.grid.PropertyRecord({name:B,value:A||E[B],type:C},B))}}this.store.loadRecords({records:D},{},true)},onUpdate:function(E,A,D){if(D==Ext.data.Record.EDIT){var B=A.data.value;var C=A.modified.value;if(this.grid.fireEvent("beforepropertychange",this.source,A.id,B,C)!==false){A.data.changeValue=this.updateSource(A.id,B,A.data.type);A.commit();this.grid.fireEvent("propertychange",this.source,A.id,B,C)}else{A.reject()}}},updateSource:function(A,C,B){var D=this.getPropertyType(A);if(!B&&D){B=D.type}if(this.grid.fireEvent("propertyvalue",this.source,A,C,B,D)){this.source[A]=C}return this.source[A]},setValue:function(B,A){this.store.getById(B).set("value",A);this.updateSource(B,A)}});Ext.ux.guid.grid.PropertyColumnModel=function(B,A){Ext.ux.guid.grid.PropertyColumnModel.superclass.constructor.call(this,B,A);this.jsonId=B.jsonId;Ext.apply(this.editors,{regexp:new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:"new RegExp()"})),"function":new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:"function(){}"})),object:new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:"{}"})),"object/array":new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:"[{}]"})),array:new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:"[]"})),template:new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:""})),mixed:new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:""})),html:new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:"",language:"html"})),css:new Ext.grid.GridEditor(new Ext.ux.form.ScriptEditor({defaultValue:"",language:"css"})),editlist:new Ext.grid.GridEditor(new Ext.ux.form.SimpleCombo({forceSelection:false,data:[],editable:true,customProperties:true})),list:new Ext.grid.GridEditor(new Ext.ux.form.SimpleCombo({forceSelection:false,data:[],editable:true,customProperties:false})),"boolean":new Ext.grid.GridEditor(new Ext.ux.form.SimpleCombo({forceSelection:false,data:[["true","true"],["false","false"]],editable:true,customProperties:true}))});this.valueRendererDelegate=this.valueRenderer.createDelegate(this);this.propertyRendererDelegate=this.propertyRenderer.createDelegate(this)};Ext.extend(Ext.ux.guid.grid.PropertyColumnModel,Ext.grid.PropertyColumnModel,{getPropertyType:function(A){if(this.grid&&this.grid.getPropertyType){return this.grid.getPropertyType(A)}return null},getCellEditor:function(A,H){var D=this.store.getProperty(H);var G=D.data.name,E=D.data.value,B=D.data.type;if(this.grid.customEditors[G]){return this.grid.customEditors[G]}var F=this.getPropertyType(G);if(F){if(F.editor){if(typeof (F.editor)!="string"){return F.editor}B=F.editor}B=B||F.type;if(!B&&F.values){var C=F.editable?this.editors.editlist:this.editors.list;C.field.setList(F.values);return C}}if(B&&this.editors[B]){return this.editors[B]}else{if(Ext.isDate(E)){return this.editors.date}else{if(typeof E=="number"){return this.editors.number}else{if(typeof E=="boolean"){return this.editors["boolean"]}}}}return this.defaultEditor||this.editors[F?"string":"mixed"]},valueRenderer:function(B,C,A){if(typeof B=="boolean"){C.css=(B?"typeBoolTrue":"typeBoolFalse");return(B?"True":"False")}var D=this.getPropertyType(A.id);if(D&&["object","array","object/array"].indexOf(D.type)!=-1){C.css="typeObject"}return B},propertyRenderer:function(A,B){var C=this.getPropertyType(A);if(C){qtip=C.desc||"";B.attr='qtip="'+qtip.replace(/"/g,"&quot;")+'"'}return A},getRenderer:function(A){return A==0?this.propertyRendererDelegate:this.valueRendererDelegate}});Ext.ux.guid.grid.PropertyGrid=Ext.extend(Ext.grid.EditorGridPanel,{enableColumnMove:false,stripeRows:false,trackMouseOver:false,clicksToEdit:1,enableHdMenu:false,viewConfig:{forceFit:true},jsonId:"__JSON__",getPropertyType:function(A){if(this.propertyTypes){var B=this.propertyTypes.find("name",A);if(B!=-1){return this.propertyTypes.getAt(B).data}}return null},initComponent:function(){this.customEditors=this.customEditors||{};this.lastEditRow=null;var B=new Ext.ux.guid.grid.PropertyStore(this);B.jsonId=this.jsonId,this.propStore=B;var A=new Ext.ux.guid.grid.PropertyColumnModel(this,B);B.store.sort("name","ASC");this.addEvents("beforepropertychange","propertychange","propertyvalue");this.cm=A;this.ds=B.store;Ext.ux.guid.grid.PropertyGrid.superclass.initComponent.call(this);this.selModel.on("beforecellselect",function(E,D,C){if(C===0){this.startEditing.defer(200,this,[D,1]);return false}},this)},onRender:function(){Ext.ux.guid.grid.PropertyGrid.superclass.onRender.apply(this,arguments);this.getGridEl().addClass("x-props-grid")},afterRender:function(){Ext.ux.guid.grid.PropertyGrid.superclass.afterRender.apply(this,arguments);if(this.source){this.setSource(this.source)}},setSource:function(A){this.propStore.setSource(A)},getSource:function(){return this.propStore.getSource()}});Ext.reg("guidpropertygrid",Ext.ux.guid.grid.PropertyGrid);Ext.namespace("Ext.ux.guid.data");Ext.ux.guid.data.FileControl=function(A){Ext.apply(this,A);Ext.ux.guid.data.FileControl.superclass.constructor.call(this);this.init()};Ext.extend(Ext.ux.guid.data.FileControl,Ext.util.Observable,{files:{},last:null,activeNode:null,init:function(){this.refreshFiles()},refreshFiles:function(A){this.files=this.files||{};if(typeof A=="function"){A(true)}},saveChanges:function(D,B,C,A){this.files[D]=D;if(B=="delete"){delete this.files[D];if(D==this.last){this.last=null}}else{this.last=D}if(typeof C=="function"){C(true)}},openFile:function(C,B,A){this.last=C;if(typeof B=="function"){B(true,A)}},deleteFile:function(B,A){this.saveChanges(B,"delete",A)},renameFile:function(C,A,D){var B=this.last;this.openFile(C,function(F,E){if(F){this.saveChanges(A,"save",function(G){if(G){this.deleteFile(C,function(H){if(H&&B==C){this.last=A}if(typeof D=="function"){D(H)}}.createDelegate(this))}else{if(typeof D=="function"){D(G)}}}.createDelegate(this),E)}else{if(typeof D=="function"){D(F)}}}.createDelegate(this))},saveFile:function(C,A,B){this.saveChanges(C,"save",B,A)},newFile:function(C,A,B){this.saveChanges(C,"new",B,A)},load:function(B,C,A){if(A){this.refreshFiles(function(){this.loadNodes(B,false,C)}.createDelegate(this))}else{this.loadNodes(B,false,C)}},loadNodes:function(D,B,L){this.activeNode=null;if(!B){while(D.firstChild){D.removeChild(D.firstChild)}}D.beginUpdate();for(var H in this.files){var E=this.files[H];var M=H.split("/");var A="";var J=D;var C;for(var G=0;G<M.length;G++){A+=M[G];C=null;for(var F=0,K=J.childNodes;F<K.length&&!C;F++){if(K[F].attributes.text==M[G]){C=K[F]}}if(!C){var I=(G==M.length-1);C=new Ext.tree.TreeNode({text:(A==this.last?"<B>"+M[G]+"</B>":M[G]),cls:I?"file":"folder",leaf:I,id:A});J.appendChild(C);if(A==this.last){this.activeNode=C}}J=C;A+="/"}}D.endUpdate();if(typeof L=="function"){L(this.activeNode)}return this.activeNode}});Ext.namespace("Ext.ux.guid.data");Ext.ux.guid.data.CookieFiles=Ext.extend(Ext.ux.guid.data.FileControl,{init:function(){this.cookies=new Ext.state.CookieProvider();Ext.ux.guid.data.CookieFiles.superclass.init.call(this)},refreshFiles:function(A){this.files=this.cookies.get("Designer.files");Ext.ux.guid.data.CookieFiles.superclass.refreshFiles.call(this,A)},saveChanges:function(D,B,C,A){if(A){this.cookies.set("Designer/"+D,escape(A))}if(B=="delete"){this.cookies.clear("Designer."+D)}Ext.ux.guid.data.CookieFiles.superclass.saveChanges.call(this,D,B,C,A);this.cookies.set("Designer.files",this.files)},openFile:function(C,B){var A=unescape(this.cookies.get("Designer/"+C));Ext.ux.guid.data.CookieFiles.superclass.openFile.call(this,C,B,A)}});Ext.namespace("Ext.ux.guid.data");Ext.ux.guid.data.PHPFiles=Ext.extend(Ext.ux.guid.data.FileControl,{url:"phpFiles.php",baseDir:"json",refreshFiles:function(A){Ext.Ajax.request({url:this.url,params:{cmd:"get_files",baseDir:this.baseDir},callback:function(C,D,B){this.files=D?Ext.util.JSON.decode(B.responseText):{};if(typeof A=="function"){A(D)}},scope:this})},saveChanges:function(D,B,C,A){Ext.Ajax.request({url:this.url,params:{cmd:"save_changes",baseDir:this.baseDir,filename:D,action:B,content:A},callback:function(F,G,E){if(G&&E.responseText=="1"){if(B=="delete"){delete this.files[D];if(D==this.last){this.last=null}}else{this.last=D}}if(typeof C=="function"){C(E.responseText=="1")}},scope:this})},openFile:function(B,A){Ext.Ajax.request({url:this.url,params:{cmd:"get_content",baseDir:this.baseDir,filename:B},callback:function(D,E,C){if(E){this.last=B}if(typeof A=="function"){A(E,C.responseText)}},scope:this})}});Ext.namespace("Ext.ux.guid.plugin");Ext.ux.guid.plugin.Designer=function(A){Ext.ux.guid.plugin.Designer.superclass.constructor.call(this,A);this.initialConfig=A};Ext.extend(Ext.ux.guid.plugin.Designer,Ext.ux.Json,{autoShow:true,disableCaching:false,toolboxTarget:false,toolboxJson:"js/Ext.ux.guid.plugin.Designer.json",customProperties:false,enableCopy:true,enableShow:true,enableEdit:true,enableVersion:true,propertyDefinitionFiles:null,propertyDefinitions:["js/Ext.ux.guid.plugin.Designer.Properties.json"],componentFiles:null,components:["js/Ext.ux.guid.plugin.Designer.Components.json"],autoLoad:false,jsonId:"__JSON__",licenseText:"/* This file is created or modified with Ext.ux.guid.plugin.GuiDesigner */",version:"2.1.0",undoBtnId:Ext.id(),redoBtnId:Ext.id(),undoHistoryMax:20,undoHistory:[],undoHistoryMark:0,fileControl:null,initialize:function(){Ext.ux.guid.plugin.Designer.superclass.initialize.call(this);Ext.QuickTips.init();this.addEvents({beforeshow:true,beforehide:true,add:true,remove:true,change:true,newconfig:true,selectelement:true,loadfailed:false})},init:function(A){this.container=A;this.container.codeConfig={};this.container.on("render",function(){this.drag=new Ext.dd.DragZone(this.container.el,{ddGroup:"designerddgroup",getDragData:this.getDragData.createDelegate(this)});this.drop=new Ext.dd.DropZone(this.container.el,{ddGroup:"designerddgroup",notifyOver:this.notifyOver.createDelegate(this),notifyDrop:this.notifyDrop.createDelegate(this)});this.container.el.on("click",function(D,B){var C=this.selectElement(B);if(B.focus){B.focus()}},this);this.resizeLayer=new Ext.Layer({cls:"resizeLayer",html:"Resize me"});this.resizeLayer.setOpacity(0.7);this.resizeLayer.resizer=new Ext.Resizable(this.resizeLayer,{handles:"se,s,e",draggable:true,dynamic:true,pinned:true});this.resizeLayer.resizer.dd.lock();this.resizeLayer.resizer.on("resize",this.resizeElement,this);this.resizeLayer.resizer.dd.endDrag=this.moveElement.createDelegate(this);this.toolbox(this.autoShow);this.createConfig();this.initContextMenu();if(this.autoLoad){if(typeof this.autoLoad!=="object"){this.autoLoad={url:this.autoLoad}}if(typeof this.autoLoad.nocache=="undefined"){this.autoLoad.nocache=this.disableCaching}this.loadConfig(this.autoLoad.url)}},this)},initContextMenu:function(){var A=new Ext.menu.Menu({items:[{text:"Delete this element",iconCls:"icon-deleteEl",scope:this,handler:function(B){this.removeElement(A.element)}},{text:"Visual resize / move",tooltip:"Visual resize the element.<br/>You can move it too if in an <b>absolute</b> layout",iconCls:"icon-resize",scope:this,handler:function(B){this.visualResize(A.element)}}]});this.container.el.on("contextmenu",function(C){C.preventDefault();var B=this.getDesignElement(this.getTarget(C));if(B){A.element=B;A.showAt(C.getXY())}},this)},visualResize:function(B){var D=this.selectElement(B);if(!D){return }var A=this.getContainer(D.ownerCt);var C=A.codeConfig?A.codeConfig.layout:null;if(C=="fit"){this.fireEvent("error","visualResize","Cannot resize element within fit layout")}else{if(C=="absolute"){this.resizeLayer.resizer.dd.unlock();this.resizeLayer.resizer.dd.constrainTo(A.body)}else{this.resizeLayer.resizer.dd.lock()}this.resizeLayer.setBox(D.el.getBox());this.resizeLayer.show()}},moveElement:function(){var B=this.activeElement;var C=this.resizeLayer.getXY();var A=this.getContainer(B.ownerCt).body.getXY();this.markUndo();B.codeConfig.x=C[0]-A[0];B.codeConfig.y=C[1]-A[1];this.redrawElement()},resizeElement:function(E,A,C){var D=this.activeElement;var B=D.el.getSize();this.markUndo();if(B.width!=A){D.codeConfig.width=A;delete D.codeConfig.columnWidth}if(B.height!=C){D.codeConfig.height=C;delete D.codeConfig.autoHeight}this.redrawElement()},removeElement:function(D,A){if(!D){return false}var B=this.getContainer(D.ownerCt);if(!A){this.markUndo()}for(var C=0;C<B.items.length;C++){if(B.items.items[C]==D){B.codeConfig.items.splice(C,1);if(B.codeConfig.items.length==0){delete B.codeConfig.items}if(!A){this.redrawElement(B);this.fireEvent("remove")}else{this.redrawContainer=true}return true}}return false},menuUpdate:function(){var A=Ext.getCmp(this.undoBtnId);if(A){if(this.undoHistoryMark>0){A.enable()}else{A.disable()}}A=Ext.getCmp(this.redoBtnId);if(A){if(this.undoHistory.length>this.undoHistoryMark+1){A.enable()}else{A.disable()}}},markUndo:function(){while(this.undoHistory.length>this.undoHistoryMark){this.undoHistory.pop()}this.undoHistory.push({config:this.encode(this.getConfig(),0,true),activeId:this.getJsonId()});while(this.undoHistory.length>this.undoHistoryMax){this.undoHistory.shift()}this.undoHistoryMark=this.undoHistory.length;this.menuUpdate()},undo:function(){if(this.undoHistoryMark>0){if(this.undoHistoryMark==this.undoHistory.length){this.undoHistory.push({config:this.encode(this.getConfig(),0,true),activeId:this.getJsonId()});this.undoHistoryMark=this.undoHistory.length-1}this.undoHistoryMark--;var A=this.undoHistory[this.undoHistoryMark];this.setConfig(A.config,true);this.selectElement(A.activeId);this.menuUpdate()}},redo:function(){if(this.undoHistory.length>this.undoHistoryMark+1){this.undoHistoryMark++;var A=this.undoHistory[this.undoHistoryMark];this.setConfig(A.config,true);this.selectElement(A.activeId);this.menuUpdate()}},appendConfig:function(B,C,H,D,A,E){if(!B){return false}this.markUndo();var J=function(O,L,K,N){if(!O.items){O.initItems()}var P=O.items.length;for(var M=0;M<O.items.length;M++){if(O.items.items[M]==K){P=(N)?M:M+1;M=O.items.length}}if(!O.codeConfig.items||!(O.codeConfig.items instanceof Array)){O.codeConfig.items=[]}delete O.codeConfig.html;if(P>O.codeConfig.items.length){O.codeConfig.items.push(L)}else{O.codeConfig.items.splice(P,0,L)}}.createDelegate(this);if(typeof C=="function"){C.call(this,function(K){this.appendConfig(B,K,true,D,A,E)}.createDelegate(this),this)}else{var I,G=this.getDesignElement(B,true);var F=this.editable(Ext.applyIf(this.clone(C),E||{}));I=this.getContainer(G);switch(D){case"abovecode":case"belowcode":I=this.isContainer(G)?this.getContainer(G.ownerCt):I;case"appendcode":this.removeElement(A,true);J(I,F,G,D=="abovecode");break;case"appendafter":J(I,F,G,false);break;case"appendbefore":J(I,F,G,true);break;case"moveafter":this.removeElement(A,true);J(I,F,G,false);break;case"movebefore":this.removeElement(A,true);J(I,F,G,true);break;case"move":this.removeElement(A,true);J(I,F);break;default:J(I,F)}this.modified=true;this.fireEvent("add");this.redrawElement(I,F[this.jsonId])}return false},createConfig:function(){if(this.container.items&&this.container.items.first()){var A=[];while(this.container.items.first()){A.push(this.container.items.first());this.container.items.remove(this.container.items.first())}var B={border:false,layout:this.container.getLayout(),items:this.editable(A)};B[this.jsonId]=Ext.id();var C=this.container.add(B);C.codeConfig=B}},loadConfig:function(A){if(this.loadMask&&this.container.ownerCt){this.container.ownerCt.el.mask(this.loadMsg,this.msgCls)}Ext.Ajax.request({url:A,method:"GET",callback:function(C,D,B){if(D){this.setConfig(B.responseText,false);this.modified=false}else{if(!this.fireEvent("loadfailed",A,B)){Ext.Msg.alert("Failure","Failed to load url :"+A)}}if(this.loadMask&&this.container.ownerCt){this.container.ownerCt.el.unmask()}},scope:this})},getCode:function(A){return this.encode(this.getConfig(A))},require:function(G,E){var D=Ext.ux.guid.plugin.Designer.superclass.require.call(this,G,E);if(D.js.length||D.css.length){var B=(this.container.items&&this.container.items.items.length==1)?this.getConfig(this.container.items.items[0]):{};if(!B.json){B.json={}}var C=new Ext.ux.Json({jsonId:this.jsonId});var H=C.decode(B[this.jsonId+"json"])||{};var A=B.json&&B.json.required_js?B.json.required_js.split(";"):[];for(var F=0;F<A.length;F++){if(D.js.indexOf(A[F])==-1){D.js.push(A[F])}}if(D.js.length!=0){H.required_js=B.json.required_js=D.js.join(";")}A=B.json&&B.json.required_css?B.json.required_css.split(";"):[];for(var F=0;F<A.length;F++){if(D.css.indexOf(A[F])==-1){D.css.push(A[F])}}if(D.css.length!=0){H.required_css=B.json.required_css=D.css.join(";")}B[this.jsonId+"json"]=C.encode(H);if(!(this.container.items&&this.container.items.items.length==1)){D.cfg=B}}return D},getConfig:function(D){if(!D&&this.container.items){D=this.container.items.items;if(D.length>1){var B=[];for(var C=0;C<D.length;C++){B.push(this.getConfig(D[C]))}return B}D=D[0]}if(!D){return{}}if(!D.codeConfig&&D[this.jsonId]){var A=function(G){if(!G){return null}if(G[this.jsonId]==D[this.jsonId]){return G}if(G.items){for(var E=0;E<G.items.length;E++){var F=A(G.items[E]);if(F){return F}}}return null}.createDelegate(this);D.codeConfig=A(this.codeConfig)}return D.codeConfig||D.initialConfig},scope:{test:"dummy"},setConfig:function(B,C){if(!C){this.markUndo()}var A=(typeof (B)=="object"?B:this.decode(B))||null;this.container.codeConfig.items=(A instanceof Array?this.editable(A):[this.editable(A)]);this.redrawElement(this.container);this.modified=true;this.fireEvent("newconfig");return true},refresh:function(){this.redrawElement(this.container)},getContainer:function(A){var B=A;while(B&&B!=this.container&&!this.isContainer(B)){B=B.ownerCt}if(B&&!B.codeConfig){B.codeConfig=this.getConfig(B)}return B},getJsonId:function(A){A=A||this.activeElement;if(!A){return null}return A[this.jsonId]?A[this.jsonId]:null},redrawElement:function(B,A){var C=B||this.activeElement;if(C){try{var G=A||this.getJsonId();var E=this.container;if(!this.redrawContainer&&C!=E){var F="";E=this.getContainer(C);while(E!=this.container&&!F){F=E.codeConfig.layout;E=this.getContainer(E.ownerCt)}}this.apply(E,this.getConfig(E).items);this.redrawContainer=false;this.selectElement(G)}catch(D){if(this.fireEvent("error","redrawElement",D)){Ext.Msg.alert("Failure","Failed to redraw element "+D)}return false}this.fireEvent("change",C);this.modified=true;return true}return false},selectElement:function(A){if(typeof (A)=="string"){A=this.findByJsonId(A)}var B=this.getDesignElement(A);this.highlightElement(B);this.resizeLayer.hide();this.resizeLayer.resizer.dd.lock();this.activeElement=B;if(B){var C=function(G,F){if(!G){return }var E=(G instanceof Ext.TabPanel)?G:null;if(E){if(F&&F!=E.getActiveTab()){E.setActiveTab(F)}for(var D=0;D<E.items.items.length;D++){if(E.items.items[D]==E.getActiveTab()&&E.codeConfig.activeTab!=D){E.codeConfig.activeTab=D;E.doLayout();return }}}C(this.getContainer(G.ownerCt),G)}.createDelegate(this);C(B,null);if(this.propertyGrid){this.propertyFilter();this.propertyGrid.enable();this.propertyGrid.setSource(B.codeConfig)}}else{if(this.propertyGrid){this.propertyGrid.disable();this.propertyGrid.setSource({})}}this.fireEvent("selectelement",B);return B},highlightElement:function(A){this.container.el.removeClass("selectedElement");this.container.el.select(".selectedElement").removeClass("selectedElement");this.container.el.select(".designerddgroup").removeClass("designerddgroup");if(A){A.addClass("selectedElement");if(A.id!=this.container.id){A.addClass("designerddgroup")}return true}return false},isElementOf:function(C,B){B=B||this.container;var A=50,E=C,D=B.getId();while(A&&E){if(E.id==D){return C}E=E.ownerCt;A--}return false},getDesignElement:function(C,A){var D,B=10;while(B&&C){D=Ext.getCmp(C.id);if(D){if(!D.codeConfig){D.codeConfig=this.getConfig(D)}if(!A&&D==this.container){return false}return this.isElementOf(D,this.container)?D:(A?this.container:false)}C=C.parentNode;B--}return A?this.container:false},findByJsonId:function(A){return this.container.findBy(function(C,B){return(C[this.jsonId]==A?true:false)},this)[0]},getDragData:function(C){var B=this.selectElement(this.getTarget(C));var A=C.getTarget(".designerddgroup");if(A&&B){return{ddel:A,config:B.initialConfig,internal:true,source:B}}},isContainer:function(A){return A instanceof Ext.Container},getTarget:function(B){if(!B){return }if(!Ext.isGecko||Ext.isGecko3){B.getTarget()}var C,A=function(I){if(I&&I.el&&I.getPosition&&I.getSize){var H=I.getPosition();var F=I.getSize();if(B.xy[0]>=H[0]&&B.xy[0]<=H[0]+F.width&&B.xy[1]>=H[1]&&B.xy[1]<=H[1]+F.height){C=I;if(I.items&&I.items.items){var G=I.items.items;for(var E=0,D=G.length;E<D&&!A(G[E]);E++){}}return true}}return false};A(this.container);return C},notifyOver:function(E,D,C){if(C.config){var B=this.getDesignElement(this.getTarget(D),true);this.selectElement(B);var A=B.getEl();if(C.internal&&!D.shiftKey){if(this.isElementOf(B,C.source,true)){return false}C.drop=this.isContainer(B)?"move":(A.getX()+(A.getWidth()/2)>Ext.lib.Event.getPageX(D)?"movebefore":"moveafter");return(C.drop=="movebefore"?"icon-element-move-before":(C.drop=="moveafter"?"icon-element-move-after":"icon-element-move"))}else{C.drop=this.isContainer(B)?"append":(A.getX()+(A.getWidth()/2)>Ext.lib.Event.getPageX(D)?"appendbefore":"appendafter");return(C.drop=="appendbefore"?"icon-element-add-before":(C.drop=="appendafter"?"icon-element-add-after":"icon-element-add"))}}C.drop=null;return false},notifyDrop:function(D,C,B){var A=this.getTarget(C);if(B.config&&!B.processed&&B.drop){this.appendConfig(A,B.config,true,B.drop,B.source,this.require(B.require).cfg);B.processed=true}return true},setObjectValue:function(A,B,E,D,C){if(B=="xtype"&&this.jsonId){if(!Ext.ComponentMgr.isTypeAvailable(E)){D={value:E,encode:true};E="panel";this.fireEvent("error","setObjectValue",new SyntaxError("xtype "+D.value+" does not exists"))}else{D=null}}return Ext.ux.guid.plugin.Designer.superclass.setObjectValue.call(this,A,B,E,D,C)},setPropertyGrid:function(A){this.propertyGrid=A;this.propertyGrid.jsonScope=this.getScope();A.on("beforepropertychange",function(C,E,B,D){this.markUndo()},this);A.on("propertyvalue",function(F,B,E,C,D){if(["object","function","mixed"].indexOf(C)!=-1||typeof (F[this.jsonId+B])=="string"||!D){this.setObjectValue(F,B,this.codeEval(E),E)}else{this.setObjectValue(F,B,E)}return false},this);A.on("propertychange",function(C,E,B,D){switch(E){case"json":this.jsonInit(this.decode(B));break}this.redrawElement.defer(200,this,[this.activeElement])},this)},toolbox:function(visible){if(!this._toolbox){for(var i=0;this.propertyDefinitionFiles&&i<this.propertyDefinitionFiles.length;i++){if(this.propertyDefinitions.indexOf(this.propertyDefinitionFiles[i])==-1){this.propertyDefinitions.push(this.propertyDefinitionFiles[i])}}for(var i=0;this.componentFiles&&i<this.componentFiles.length;i++){if(this.components.indexOf(this.componentFiles[i])==-1){this.components.push(this.componentFiles[i])}}var proxy=new Ext.ux.data.HttpMergeProxy(this.propertyDefinitions);this.properties=new Ext.data.JsonStore({proxy:proxy,sortInfo:{field:"name",order:"ASC"},root:"properties",fields:["name","type","defaults","desc","instance","editable","values","editor"]});if(Ext.isVersion("2.0","2.1.9")){this.properties.proxy=proxy}this.properties.load();var filterByFn=function(rec,id){var i=rec.get("instance");if(i){return eval("this.activeElement instanceof "+i)}return true}.createDelegate(this);this.propertyFilter=function(){this.properties.filterBy(filterByFn,this)};this.toolboxTarget=Ext.getCmp(this.toolboxTarget);if(this.toolboxTarget){this._toolbox=this.toolboxTarget;this._toolbox.add(new Ext.ux.JsonPanel({autoLoad:this.toolboxJson,disableCaching:this.disableCaching,scope:this}))}else{this._toolbox=new Ext.ux.JsonWindow({x:-1000,y:-1000,autoLoad:this.toolboxJson,disableCaching:this.disableCaching,scope:this,closable:false})}}if(visible||visible===true){if(this.fireEvent("beforeshow",this._toolbox)){this._toolbox.show();this._toolbox.doLayout()}}else{if(this.fireEvent("beforehide",this._toolbox)){this._toolbox.hide()}}}});Ext.override(Ext.form.Label,{onRender:function(B,A){if(!this.el){this.el=document.createElement("label");this.el.innerHTML=this.text?Ext.util.Format.htmlEncode(this.text):(this.html||"");if(this.forId){this.el.setAttribute("htmlFor",this.forId)}this.el.id=this.id;this.id=this.id+"-"}Ext.form.Label.superclass.onRender.call(this,B,A)},setText:function(A,B){this.text=B!==false?A:"";this.html=B!==false?"":A;if(this.rendered){this.el.dom.innerHTML=B!==false?Ext.util.Format.htmlEncode(A):A}return this}});