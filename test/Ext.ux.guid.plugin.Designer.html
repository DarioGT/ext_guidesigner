<!--
  * Author: Sierk Hoeksma. WebBlocks.eu
  * Copyright 2007-2008, WebBlocks.  All rights reserved.
  *
  * This extension adds Gui Designer  Support to ExtJs
  ************************************************************************************
  *   This file is distributed on an AS IS BASIS WITHOUT ANY WARRANTY;
  *   without even the implied warranty of MERCHANTABILITY or
  *   FITNESS FOR A PARTICULAR PURPOSE.
  ************************************************************************************

  License: This source is licensed under the terms of the Open Source LGPL 3.0 license.
  Commercial use is permitted to the extent that the code/component(s) do NOT become
  part of another Open Source or Commercially licensed development library or toolkit
  without explicit permission.Full text: http://www.opensource.org/licenses/lgpl-3.0.html

  * Donations are welcomed: http://donate.webblocks.eu
-->
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="../extjs/resources/css/ext-all.css" />
		<script type="text/javascript" src="../extjs/adapter/ext/ext-base.js"></script>
		<script type="text/javascript" src="../extjs/ext-all-debug.js"></script>

        <!-- Remove this file if you don't need local file support -->
        <script id="localXHR.js" type="text/javascript" src="../js/localXHR.js" type="text/javascript"></script>

        <!-- The test framework -->
		<script src="../lib/Test/Builder.js" type="text/javascript"></script>
		<script src="../lib/Test/More.js" type="text/javascript"></script>

		<!-- General components  -->
	    <script id="Ext.ux.Override.js" src="../js/Ext.ux.Override.js" type="text/javascript"></script>
	    <script id="Ext.ux.ComponentCollection.js" src="../js/Ext.ux.ComponentCollection.js" type="text/javascript"></script>
		<script id="Ext.ux.Util.js" src="../js/Ext.ux.Util.js" type="text/javascript"></script>
		<script id="Ext.ux.Json.js" src="../js/Ext.ux.Json.js" type="text/javascript"></script>

		<!-- Add Code press as script editor, remove line below to used textarea as script editor  -->
		<script id="Ext.ux.CodePress.js" src="../js/codepress/Ext.ux.CodePress.js" type="text/javascript"></script>

        <!-- Default functions -->
	    <script id="Ext.ux.form.ScriptEditor.js" src="../js/Ext.ux.form.ScriptEditor.js" type="text/javascript"></script>
	    <script id="Ext.ux.data.HttpMergeProxy.js" src="../js/Ext.ux.data.HttpMergeProxy.js" type="text/javascript"></script>
		<script id="Ext.ux.JsonPanel.js" src="../js/Ext.ux.JsonPanel.js" type="text/javascript"></script>
		<script id="Ext.ux.JsonWindow.js" src="../js/Ext.ux.JsonWindow.js" type="text/javascript"></script>

	    <!-- Designer functions -->
	    <link id="Ext.ux.guid.plugin.Designer.css" rel="stylesheet" href="../css/Ext.ux.guid.plugin.Designer.css" type="text/css" />
		<script id="Ext.ux.guid.tree.JsonTreeLoader.js" src="../js/Ext.ux.guid.tree.JsonTreeLoader.js" type="text/javascript"></script>
		<script id="Ext.ux.guid.tree.CodeLoader.js" src="../js/Ext.ux.guid.tree.CodeLoader.js" type="text/javascript"></script>
	    <script id="Ext.ux.guid.grid.PropertyGrid.js" src="../js/Ext.ux.guid.grid.PropertyGrid.js" type="text/javascript"></script>
	    <script id="Ext.ux.guid.data.FileControl.js" src="../js/Ext.ux.guid.data.FileControl.js" type="text/javascript"></script>
	    <script id="Ext.ux.guid.data.CookieFiles.js" src="../js/Ext.ux.guid.data.CookieFiles.js" type="text/javascript"></script>
	    <script id="Ext.ux.guid.data.PHPFiles.js" src="../js/Ext.ux.guid.data.PHPFiles.js" type="text/javascript"></script>
	    <script id="Ext.ux.guid.plugin.Designer.js" src="../js/Ext.ux.guid.plugin.Designer.js" type="text/javascript"></script>

		<!--The test function that fires when body is loaded -->
		<script>
			Ext.onReady(function(){
				plan({ tests: 2 });

				//diag('Designer operations:');
				var phpSupport;
				var designer;
				var designer_panel = new Ext.Panel({
					applyTo : 'designer',
					height : 500,
					border:false,
	                bodyBorder:false,
	                bodyStyle:'background:black;border:dashed green 1px;',
					plugins : [
					  designer = new Ext.ux.guid.plugin.Designer({
							toolboxTarget : 'toolbox',
							disableCaching : true,
							customProperties : true,
							fileControl      : phpSupport ? new Ext.ux.guid.data.PHPFiles() : new Ext.ux.guid.data.CookieFiles()
						})
					]

				});

				var config = '\
/* This file is created or modified with Ext.ux.plugin.GuiDesigner */\
{\
width : 800,\
height : 500,\
xtype : "form",\
items : [{\
    xtype : "panel",\
    layout : "column",\
    items : [{\
        columnWidth : 0.5,\
        layout : "form",\
        items : [{\
            xtype : "textfield",\
            id : "add_place_lat_fld",\
            fieldLabel : "lat"\
          }]\
      },{\
        columnWidth : 0.5,\
        layout : "form",\
        items : [{\
            xtype : "textfield",\
            id : "add_place_lng_fld",\
            fieldLabel : "long"\
          }]\
      }]\
  }]\
}\
				';

				designer.setConfig(config);

				var cfg = designer.getConfig();
				designer.setConfig({}); //Clear config as fixed
				var w = new Ext.Window(Ext.apply({
                    title  : 'Show Config',
                    border  : false,
                    width:600,
                    height: 400,
                    iconCls: 'icon-show',
                    modal       : true,
                    maximizable : true,
                    closeAction : 'close',
                    items       : cfg,
                    listeners   : { 'beforeclose' : function(){
                       designer.undo();
                                  }}
                    },config.json));
                w.show();
                //You cannot use w.getComponent because items is not direct child of window
				ok(Ext.getCmp('add_place_lng_fld'),'lng founded');
				ok(Ext.getCmp('add_place_lat_fld'),'lat founded');
			});
		</script>
	</head>

 	<body>
		<H1>Ext.ux.Json test suite</H1>
		<div id="designer"></div>

	</body>
 </html>