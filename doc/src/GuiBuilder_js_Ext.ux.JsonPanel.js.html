<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.linenumber {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='linenumber'>  1</span> <span class="COMM">/*global Ext document */</span><span class="WHIT">
<span class='linenumber'>  2</span> </span><span class="COMM">/*  
<span class='linenumber'>  3</span>   * Author: Sierk Hoeksma. WebBlocks.eu
<span class='linenumber'>  4</span>   * Copyright 2007-2008, WebBlocks.  All rights reserved.
<span class='linenumber'>  5</span>   *
<span class='linenumber'>  6</span>   * This extension enables a panel to be directly created from Gui Designer Json
<span class='linenumber'>  7</span>   * Dependend JavaScripts are loaded using ScriptLoader function
<span class='linenumber'>  8</span>   ************************************************************************************
<span class='linenumber'>  9</span>   *   This file is distributed on an AS IS BASIS WITHOUT ANY WARRANTY;
<span class='linenumber'> 10</span>   *   without even the implied warranty of MERCHANTABILITY or
<span class='linenumber'> 11</span>   *   FITNESS FOR A PARTICULAR PURPOSE.
<span class='linenumber'> 12</span>   ************************************************************************************
<span class='linenumber'> 13</span> 
<span class='linenumber'> 14</span>   License: This source is licensed under the terms of the Open Source LGPL 3.0 license.
<span class='linenumber'> 15</span>   Commercial use is permitted to the extent that the code/component(s) do NOT become
<span class='linenumber'> 16</span>   part of another Open Source or Commercially licensed development library or toolkit
<span class='linenumber'> 17</span>   without explicit permission.Full text: http://www.opensource.org/licenses/lgpl-3.0.html
<span class='linenumber'> 18</span> 
<span class='linenumber'> 19</span>   * Donations are welcomed: http://donate.webblocks.eu
<span class='linenumber'> 20</span>   */</span><span class="WHIT">
<span class='linenumber'> 21</span> 
<span class='linenumber'> 22</span> </span><span class="COMM">/**
<span class='linenumber'> 23</span>  * Override Ext.Panel so that scope of keymap is always set to object when not set, 
<span class='linenumber'> 24</span>  * instead of window 
<span class='linenumber'> 25</span>  */</span><span class="WHIT">
<span class='linenumber'> 26</span> </span><span class="NAME">Ext.override</span><span class="PUNC">(</span><span class="NAME">Ext.Panel</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 27</span> </span><span class="WHIT">   </span><span class="COMM">// private</span><span class="WHIT">
<span class='linenumber'> 28</span> </span><span class="WHIT">    </span><span class="NAME">getKeyMap</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 29</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.keyMap</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 30</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Ext.isArray</span><span class="PUNC">(</span><span class="NAME">this.keys</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">          </span><span class="WHIT">
<span class='linenumber'> 31</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.keys.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 32</span> </span><span class="WHIT">            </span><span class="NAME">this.keys</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.keys</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 33</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 34</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.keys</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.keys.scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.keys.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 35</span> </span><span class="WHIT">        </span><span class="NAME">this.keyMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.KeyMap</span><span class="PUNC">(</span><span class="NAME">this.el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.keys</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 36</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 37</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.keyMap</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 38</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 39</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 40</span> 
<span class='linenumber'> 41</span> </span><span class="COMM">/**
<span class='linenumber'> 42</span>  * A Synchronized Content loader for data from url
<span class='linenumber'> 43</span>  * @param {String} url The url to load synchronized
<span class='linenumber'> 44</span>  * @param {Boolean} cachingOff Should caching of file be disabled
<span class='linenumber'> 45</span>  * @param {Boolean} responseXML Should responseXML be returned instead of responseText
<span class='linenumber'> 46</span>  * @return {Boolean/String/XMLObject} When there was a error False otherwise response base on responseXML flag
<span class='linenumber'> 47</span>  */</span><span class="WHIT">
<span class='linenumber'> 48</span> </span><span class="NAME">Ext.ux.SyncLoader</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">cachingOff</span><span class="PUNC">,</span><span class="NAME">responseXML</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 49</span> </span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activeX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ext.lib.Ajax.activeX</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 50</span> </span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isLocal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.location.protocol</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'file:'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 51</span> </span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 52</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 53</span> </span><span class="WHIT"> </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 54</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Ext.isIE7</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isLocal</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"IE7forceActiveX"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 55</span> </span><span class="WHIT">  </span><span class="NAME">conn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 56</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 57</span> </span><span class="WHIT">   </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">activeX.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 58</span> </span><span class="WHIT">     </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">conn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">activeX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 59</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 60</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 61</span> </span><span class="WHIT"> </span><span class="COMM">//Should we disable caching</span><span class="WHIT">
<span class='linenumber'> 62</span> </span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">cachingOff</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'> 63</span> </span><span class="WHIT">    </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">'?'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'&'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'?'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'_dc='</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 64</span> </span><span class="WHIT"> </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 65</span> </span><span class="WHIT">  </span><span class="NAME">conn.open</span><span class="PUNC">(</span><span class="STRN">'GET'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 66</span> </span><span class="WHIT">  </span><span class="NAME">conn.send</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 67</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">isLocal</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">conn.responseText.length</span><span class="PUNC">!=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">conn.status</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">conn.status</span><span class="PUNC">>=</span><span class="NUMB">200</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">conn.status</span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">300</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 68</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">responseXML</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">conn.responseXML</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">conn.responseText</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 69</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 70</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 71</span> </span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 72</span> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 73</span> 
<span class='linenumber'> 74</span> </span><span class="COMM">/**
<span class='linenumber'> 75</span>  * Function used to load a JavaScript into a document.head element
<span class='linenumber'> 76</span>  * the id of the script item is the name of the file.
<span class='linenumber'> 77</span>  * @param {String} url The url to load javascript from
<span class='linenumber'> 78</span>  * @param {Boolean} cachingOff Should caching of javascript files be disabled
<span class='linenumber'> 79</span>  * @return {Boolean} Indicator if load went corretly true/false
<span class='linenumber'> 80</span>  */</span><span class="WHIT">
<span class='linenumber'> 81</span> </span><span class="NAME">Ext.ux.ScriptLoader</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">cachingOff</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 82</span> </span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 83</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ext.ux.SyncLoader</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="NAME">cachingOff</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 84</span> </span><span class="WHIT">   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 85</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">head</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"head"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 86</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">script</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"script"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 87</span> </span><span class="WHIT">   </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 88</span> </span><span class="WHIT">     </span><span class="NAME">script.text</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">content</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 89</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 90</span> </span><span class="WHIT">     </span><span class="NAME">script.appendChild</span><span class="PUNC">(</span><span class="NAME">content</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 91</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 92</span> </span><span class="WHIT">   </span><span class="NAME">script.setAttribute</span><span class="PUNC">(</span><span class="STRN">"type"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text/javascript"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 93</span> </span><span class="WHIT">   </span><span class="NAME">script.setAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 94</span> </span><span class="WHIT">   </span><span class="NAME">head.appendChild</span><span class="PUNC">(</span><span class="NAME">script</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 95</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 96</span> </span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 97</span> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 98</span> 
<span class='linenumber'> 99</span> 
<span class='linenumber'>100</span> </span><span class="COMM">/**
<span class='linenumber'>101</span>  * A class used by JsonPanel and JsonWindow to load a jsonFile
<span class='linenumber'>102</span>  */</span><span class="WHIT">
<span class='linenumber'>103</span> </span><span class="NAME">Ext.ux.Json</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ext.extend</span><span class="PUNC">(</span><span class="NAME">Ext.util.Observable</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>104</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>105</span>      * Boolean indicator when true loadMsg will be shown
<span class='linenumber'>106</span>      @cfg */</span><span class="WHIT">
<span class='linenumber'>107</span> </span><span class="WHIT">    </span><span class="NAME">loadMask</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>108</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>109</span>      * The loading message
<span class='linenumber'>110</span>      @cfg */</span><span class="WHIT">
<span class='linenumber'>111</span> </span><span class="WHIT">    </span><span class="NAME">loadMsg</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'Loading...'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>112</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>113</span>      * Mask used for loading message
<span class='linenumber'>114</span>      @cfg */</span><span class="WHIT">
<span class='linenumber'>115</span> </span><span class="WHIT">    </span><span class="NAME">msgCls</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'x-mask-loading'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>116</span> </span><span class="WHIT">   </span><span class="WHIT">
<span class='linenumber'>117</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>118</span>      * The string used to indent   
<span class='linenumber'>119</span>      * @type {String} 
<span class='linenumber'>120</span>      @cfg */</span><span class="WHIT">
<span class='linenumber'>121</span> </span><span class="WHIT">    </span><span class="NAME">indentString</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'  '</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>122</span> 
<span class='linenumber'>123</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>124</span>      * Array with items which should be blocked during init
<span class='linenumber'>125</span>      * @type {Array}
<span class='linenumber'>126</span>      @cfg */</span><span class="WHIT">
<span class='linenumber'>127</span> </span><span class="WHIT">    </span><span class="NAME">blockedJsonInit</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'required_js'</span><span class="PUNC">,</span><span class="STRN">'required_css'</span><span class="PUNC">,</span><span class="STRN">'items'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>128</span> 
<span class='linenumber'>129</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>130</span>     * Should caching be disabled when JSON are loaded (defaults false).   
<span class='linenumber'>131</span>     * @type {Boolean} 
<span class='linenumber'>132</span>     @cfg */</span><span class="WHIT">
<span class='linenumber'>133</span> </span><span class="WHIT">    </span><span class="NAME">disableCaching</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>134</span> 
<span class='linenumber'>135</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>136</span>     * @private Tag added to json code so whe can see begining of code  
<span class='linenumber'>137</span>     */</span><span class="WHIT">
<span class='linenumber'>138</span> </span><span class="WHIT">    </span><span class="NAME">scriptStart</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'/*BEGIN*/'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>139</span> 
<span class='linenumber'>140</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>141</span>     * @private Tag added to json code so whe can see ending of code
<span class='linenumber'>142</span>     */</span><span class="WHIT">
<span class='linenumber'>143</span> </span><span class="WHIT">    </span><span class="NAME">scriptEnd</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'/*END*/'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>144</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>145</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>146</span>      * The lisenceText that should be added to each JSON File Created
<span class='linenumber'>147</span>      * @type {String}
<span class='linenumber'>148</span>      @cfg */</span><span class="WHIT">
<span class='linenumber'>149</span> </span><span class="WHIT">    </span><span class="NAME">licenseText</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>150</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>151</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>152</span>      * @private Indicator if object hasOwnProperty
<span class='linenumber'>153</span>      */</span><span class="WHIT">
<span class='linenumber'>154</span> </span><span class="WHIT">    </span><span class="NAME">useHasOwn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>155</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>156</span> </span><span class="WHIT">    </span><span class="COMM">//@private The internal tag used to create unique, when null no id is generated</span><span class="WHIT">
<span class='linenumber'>157</span> </span><span class="WHIT">    </span><span class="NAME">jsonId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>158</span> </span><span class="WHIT">    </span><span class="COMM">//@private Last id used to create json</span><span class="WHIT">
<span class='linenumber'>159</span> </span><span class="WHIT">    </span><span class="NAME">lastJsonId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>160</span> 
<span class='linenumber'>161</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>162</span> </span><span class="WHIT">    </span><span class="COMM">//@private The maximum number of json histories to keep</span><span class="WHIT">
<span class='linenumber'>163</span> </span><span class="WHIT">    </span><span class="NAME">jsonHistoryMax</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>164</span> </span><span class="WHIT">    </span><span class="COMM">//@private The history for json</span><span class="WHIT">
<span class='linenumber'>165</span> </span><span class="WHIT">    </span><span class="NAME">jsonHistory</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>166</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>167</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>168</span>      * Add a json to the json history
<span class='linenumber'>169</span>      * @param {String} json the json to add
<span class='linenumber'>170</span>      */</span><span class="WHIT">
<span class='linenumber'>171</span> </span><span class="WHIT">    </span><span class="NAME">addJsonHistory</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>172</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>173</span> </span><span class="WHIT">        </span><span class="NAME">this.jsonHistory.push</span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>174</span> </span><span class="WHIT">        </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.jsonHistory.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.jsonHistoryMax</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>175</span> </span><span class="WHIT">          </span><span class="NAME">this.jsonHistory.remove</span><span class="PUNC">(</span><span class="NAME">this.jsonHistory</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>176</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>177</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>178</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>179</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>180</span>      * Get the last item from the json history
<span class='linenumber'>181</span>      * @param {Boolean} keep Should history be untouched
<span class='linenumber'>182</span>      * @return {String} The json
<span class='linenumber'>183</span>      */</span><span class="WHIT">
<span class='linenumber'>184</span> </span><span class="WHIT">    </span><span class="NAME">getJsonHistory</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>185</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.jsonHistory.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>186</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.jsonHistory</span><span class="PUNC">[</span><span class="NAME">this.jsonHistory.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>187</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.jsonHistory.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>188</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>189</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>190</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>191</span> 
<span class='linenumber'>192</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>193</span>      * Load one or more javascripts. Is trigger by root element window.required_js in json file. 
<span class='linenumber'>194</span>      * The javascripts are synchonrized load before the JSON is evaluated. Base on the config item
<span class='linenumber'>195</span>      * disableCaching (defaults true) the url of the javascript to load is made unique with parameter _dc.
<span class='linenumber'>196</span>      * @param {String} list A comma seperated list of javascripts to load
<span class='linenumber'>197</span>      */</span><span class="WHIT">
<span class='linenumber'>198</span> </span><span class="WHIT">    </span><span class="NAME">setRequired_js</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">   </span><span class="WHIT">
<span class='linenumber'>199</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>200</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">files</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">list.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>201</span> </span><span class="WHIT">     </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">&lt;</span><span class="NAME">files.length</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>202</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Ext.ux.ScriptLoader</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.disableCaching</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>203</span> </span><span class="WHIT">          </span><span class="NAME">Ext.Msg.alert</span><span class="PUNC">(</span><span class="STRN">'Failure'</span><span class="PUNC">,</span><span class="STRN">'Failed to load javascript '</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>204</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>205</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>206</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>207</span> 
<span class='linenumber'>208</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>209</span>      * Load one or more stylesheets. Is triggered by root element window.required_css in json file
<span class='linenumber'>210</span>      * @param {String} list A comma seperated list of stylesheets to load
<span class='linenumber'>211</span>      */</span><span class="WHIT">
<span class='linenumber'>212</span> </span><span class="WHIT">    </span><span class="NAME">setRequired_css</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>213</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>214</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">files</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">list.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>215</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">&lt;</span><span class="NAME">files.length</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>216</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>217</span> </span><span class="WHIT">        </span><span class="NAME">Ext.util.CSS.swapStyleSheet</span><span class="PUNC">(</span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">files</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>218</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>219</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>220</span> 
<span class='linenumber'>221</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>222</span>     * Added items to blockedJsonInit during jsonInit
<span class='linenumber'>223</span>     * @param {Object} args A object indexed by xtype containing array of blocked keys
<span class='linenumber'>224</span>     */</span><span class="WHIT">
<span class='linenumber'>225</span> </span><span class="WHIT">    </span><span class="NAME">setBlockedJsonInit</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>226</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getXType</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>227</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">[</span><span class="NAME">this.getXType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>228</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>229</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">val.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.blockedJsonInit.push</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>230</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.blockedJsonInit.push</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>231</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>232</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>233</span> 
<span class='linenumber'>234</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>235</span>     * Function called with config object of json file
<span class='linenumber'>236</span>     * @param {Object} config The config object that can be applied
<span class='linenumber'>237</span>     * @return {Boolean} indicator if all changes where set
<span class='linenumber'>238</span>     */</span><span class="WHIT">
<span class='linenumber'>239</span> </span><span class="WHIT">    </span><span class="NAME">jsonInit</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">,</span><span class="NAME">all</span><span class="PUNC">,</span><span class="NAME">scopeOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>240</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">allSet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>241</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>242</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">config</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">       </span><span class="WHIT">
<span class='linenumber'>243</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>244</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">all</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.blockedJsonInit.indexOf</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>245</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="STRN">'required_js'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>246</span> </span><span class="WHIT">            </span><span class="NAME">this.setRequired_js</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>247</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="STRN">'required_css'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>248</span> </span><span class="WHIT">             </span><span class="NAME">this.setRequired_css</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>249</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>250</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">applyTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>251</span> </span><span class="WHIT">            </span><span class="COMM">//When scope of var set if</span><span class="WHIT">
<span class='linenumber'>252</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i.indexOf</span><span class="PUNC">(</span><span class="STRN">'scope.'</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>253</span> </span><span class="WHIT">               </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i.substring</span><span class="PUNC">(</span><span class="NUMB">6</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>254</span> </span><span class="WHIT">               </span><span class="NAME">applyTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getJsonScope</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>255</span> </span><span class="WHIT">               </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">'Created '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>256</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scopeOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>257</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'set'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">j.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">j.substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>258</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>259</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">applyTo</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">applyTo</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>260</span> </span><span class="WHIT">                </span><span class="NAME">applyTo</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="NAME">config</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>261</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">applyTo</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">applyTo</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>262</span> </span><span class="WHIT">                </span><span class="NAME">applyTo</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="NAME">config</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>263</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>264</span> </span><span class="WHIT">                </span><span class="NAME">applyTo</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">config</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>265</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>266</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>267</span> </span><span class="WHIT">              </span><span class="NAME">allSet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>268</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>269</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>270</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>271</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>272</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>273</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">allSet</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>274</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>275</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>276</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>277</span>      * Check if a object is empty
<span class='linenumber'>278</span>      */</span><span class="WHIT">
<span class='linenumber'>279</span> </span><span class="WHIT">    </span><span class="NAME">isEmptyObject</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>280</span> </span><span class="WHIT">     </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="NAME">this.jsonId</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>281</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>282</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>283</span> 
<span class='linenumber'>284</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='linenumber'>285</span>     * Apply the Json to given element
<span class='linenumber'>286</span>     * @param {Object/String} json The json to apply
<span class='linenumber'>287</span>     * @param {Element} element The element to apply the json to
<span class='linenumber'>288</span>     * @return {Object} The elements applied
<span class='linenumber'>289</span>     */</span><span class="WHIT">
<span class='linenumber'>290</span> </span><span class="WHIT">    </span><span class="NAME">applyJson</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">,</span><span class="NAME">element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>291</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>292</span> </span><span class="WHIT">     </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>293</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.loadMask</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.ownerCt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">el.ownerCt.el.mask</span><span class="PUNC">(</span><span class="NAME">this.loadMsg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.msgCls</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>294</span> </span><span class="WHIT">       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.jsonId</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.editableJson</span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">json</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>295</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.decode</span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>296</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>297</span> </span><span class="WHIT">         </span><span class="COMM">//Apply global json vars to element</span><span class="WHIT">
<span class='linenumber'>298</span> </span><span class="WHIT">         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Ext.Container</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>299</span> </span><span class="WHIT">           </span><span class="COMM">//Clear out orignal content of container</span><span class="WHIT">
<span class='linenumber'>300</span> </span><span class="WHIT">           </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.items</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.items.first</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">el.remove</span><span class="PUNC">(</span><span class="NAME">el.items.first</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>301</span> </span><span class="WHIT">           </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">items</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>302</span> </span><span class="WHIT">             </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">items.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.jsonInit</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">json</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>303</span> </span><span class="WHIT">             </span><span class="NAME">el.add.apply</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="NAME">items</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>304</span> </span><span class="WHIT">           </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Only add items when it is not empty</span><span class="WHIT">
<span class='linenumber'>305</span> </span><span class="WHIT">             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>306</span> </span><span class="WHIT">             </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="NAME">this.jsonId</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">l</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>307</span> </span><span class="WHIT">             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isEmptyObject</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>308</span> </span><span class="WHIT">                </span><span class="NAME">this.jsonInit</span><span class="PUNC">(</span><span class="NAME">items.json</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>309</span> </span><span class="WHIT">                </span><span class="NAME">el.add</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>310</span> </span><span class="WHIT">             </span><span class="PUNC">}</span><span class="WHIT">              </span><span class="WHIT">
<span class='linenumber'>311</span> </span><span class="WHIT">           </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>312</span> </span><span class="WHIT">         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>313</span> </span><span class="WHIT">           </span><span class="COMM">//This is not a container so try to update element using jsonInit construction</span><span class="WHIT">
<span class='linenumber'>314</span> </span><span class="WHIT">           </span><span class="NAME">this.jsonInit</span><span class="PUNC">(</span><span class="NAME">items.json</span><span class="PUNC">,</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>315</span> </span><span class="WHIT">           </span><span class="NAME">this.jsonInit</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">,</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>316</span> </span><span class="WHIT">         </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>317</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>318</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.rendered</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.layout</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.layout.layout</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">el.doLayout</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">     </span><span class="WHIT">
<span class='linenumber'>319</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">     </span><span class="WHIT">
<span class='linenumber'>320</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>321</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">finally</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>322</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.loadMask</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.ownerCt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">el.ownerCt.el.unmask</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>323</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>324</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>325</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>326</span> 
<span class='linenumber'>327</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='linenumber'>328</span>     * Convert a Json to a editableJson by adding an edtiableId when set
<span class='linenumber'>329</span>     * @param {Object/String} json The json to add an id to
<span class='linenumber'>330</span>     * @param {Object} id The id object used to give id
<span class='linenumber'>331</span>     * @return {Object} The decoded object with id
<span class='linenumber'>332</span>     */</span><span class="WHIT">
<span class='linenumber'>333</span> </span><span class="WHIT">    </span><span class="NAME">editableJson</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>334</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">json</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>335</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.decode</span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>336</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">items</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>337</span> </span><span class="WHIT">       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">items.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>338</span> </span><span class="WHIT">        </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this.editableJson</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>339</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>340</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>341</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>342</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.jsonId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>343</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">this.jsonId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>344</span> </span><span class="WHIT">         </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">this.jsonId</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Ext.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>345</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>346</span> </span><span class="WHIT">       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">      </span><span class="WHIT">
<span class='linenumber'>347</span> </span><span class="WHIT">         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">k.indexOf</span><span class="PUNC">(</span><span class="NAME">this.jsonId</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">!=</span><span class="NAME">this.jsonId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>348</span> </span><span class="WHIT">           </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">orgK</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">k.substring</span><span class="PUNC">(</span><span class="NAME">this.jsonId.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>349</span> </span><span class="WHIT">           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">orgK</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">orgK</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">orgK</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//Code is there but not key, create it</span><span class="WHIT">
<span class='linenumber'>350</span> </span><span class="WHIT">         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">this.jsonId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>351</span> </span><span class="WHIT">           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>352</span> </span><span class="WHIT">             </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">this.jsonId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>353</span> </span><span class="WHIT">           </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">!=</span><span class="STRN">'items'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>354</span> </span><span class="WHIT">            </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">this.jsonId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ext.ux.JSON.encode</span><span class="PUNC">(</span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>355</span> </span><span class="WHIT">           </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>356</span> </span><span class="WHIT">         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>357</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>358</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">items.items</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">items.items</span><span class="PUNC">=</span><span class="NAME">this.editableJson</span><span class="PUNC">(</span><span class="NAME">items.items</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>359</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>360</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>361</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>362</span> 
<span class='linenumber'>363</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>364</span>      * @private Encode a string to Json
<span class='linenumber'>365</span>      * @param {String} s The string to encode
<span class='linenumber'>366</span>      * @return {String} A string containing the encode string 
<span class='linenumber'>367</span>      */</span><span class="WHIT">
<span class='linenumber'>368</span> </span><span class="WHIT">    </span><span class="NAME">encodeString</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>369</span> </span><span class="WHIT">       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">"\b"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'\\b'</span><span class="PUNC">,</span><span class="STRN">"\t"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'\\t'</span><span class="PUNC">,</span><span class="STRN">"\n"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'\\n'</span><span class="PUNC">,</span><span class="STRN">"\f"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'\\f'</span><span class="PUNC">,</span><span class="STRN">"\r"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'\\r'</span><span class="PUNC">,</span><span class="STRN">'"'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'\\"'</span><span class="PUNC">,</span><span class="STRN">"\\"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'\\\\'</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>370</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="REGX">/["\\\x00-\x1f]/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">//"</span><span class="WHIT">
<span class='linenumber'>371</span> </span><span class="WHIT">           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">s.replace</span><span class="PUNC">(</span><span class="REGX">/([\x00-\x1f\\"])/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">//"</span><span class="WHIT">
<span class='linenumber'>372</span> </span><span class="WHIT">               </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>373</span> </span><span class="WHIT">               </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>374</span> </span><span class="WHIT">               </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b.charCodeAt</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>375</span> </span><span class="WHIT">               </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"\\u00"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='linenumber'>376</span> </span><span class="WHIT">                   </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">c</span><span class="WHIT"> </span><span class="REGX">/ 16).toString(16) +
<span class='linenumber'>377</span>                    (c % 16).toString(16);
<span class='linenumber'>378</span>            })  + '"';
<span class='linenumber'>379</span>        }
<span class='linenumber'>380</span>        return '"' + s + '"';
<span class='linenumber'>381</span>      },
<span class='linenumber'>382</span> 
<span class='linenumber'>383</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>384</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT"> </span><span class="NAME">Create</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="NAME">indent</span><span class="WHIT"> </span><span class="NAME">so</span><span class="WHIT"> </span><span class="NAME">code</span><span class="WHIT"> </span><span class="NAME">is</span><span class="WHIT"> </span><span class="NAME">readable</span><span class="WHIT">
<span class='linenumber'>385</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Int</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">indent</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT">
<span class='linenumber'>386</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">String</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">A</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT"> </span><span class="NAME">containing</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="NAME">spaces</span><span class="WHIT">
<span class='linenumber'>387</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>388</span>      indentStr : function(n) {
<span class='linenumber'>389</span>        var str = "", i = 0;
<span class='linenumber'>390</span>        while (i&lt;n) {
<span class='linenumber'>391</span>          str += this.indentString;
<span class='linenumber'>392</span>          i++;
<span class='linenumber'>393</span>        }
<span class='linenumber'>394</span>        return str;
<span class='linenumber'>395</span>      },  
<span class='linenumber'>396</span> 
<span class='linenumber'>397</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>398</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT"> </span><span class="NAME">Encode</span><span class="WHIT"> </span><span class="NAME">an</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">Json</span><span class="WHIT">
<span class='linenumber'>399</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Array</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">array</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">encode</span><span class="WHIT">
<span class='linenumber'>400</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Int</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">indent</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">indent</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">uses</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">defaults</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>401</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Boolean</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">notags</span><span class="WHIT"> </span><span class="NAME">Should</span><span class="WHIT"> </span><span class="NAME">code</span><span class="WHIT"> </span><span class="NAME">be</span><span class="WHIT"> </span><span class="NAME">wrapped</span><span class="WHIT"> </span><span class="NAME">between</span><span class="WHIT"> </span><span class="NAME">scriptStart</span><span class="WHIT"> </span><span class="NAME">and</span><span class="WHIT"> </span><span class="NAME">scriptEnd</span><span class="WHIT">
<span class='linenumber'>402</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">String</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">array</span><span class="WHIT"> </span><span class="NAME">encode</span><span class="WHIT"> </span><span class="NAME">as</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT">
<span class='linenumber'>403</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>404</span>      encodeArray  : function(o,indent,keepJsonId){
<span class='linenumber'>405</span>        indent = indent || 0;
<span class='linenumber'>406</span>        var a = ["["], b, i, l = o.length, v;
<span class='linenumber'>407</span>        for (i = 0; i &lt; l; i += 1) {
<span class='linenumber'>408</span>          v = o[i];
<span class='linenumber'>409</span>          switch (typeof v) {
<span class='linenumber'>410</span>            case "undefined":
<span class='linenumber'>411</span>            case "unknown":
<span class='linenumber'>412</span>                break;
<span class='linenumber'>413</span>            default:
<span class='linenumber'>414</span>                if (b) a.push(',');
<span class='linenumber'>415</span>                a.push(v === null ? "null" : this.encode(v, indent + 1,keepJsonId));
<span class='linenumber'>416</span>                b = true;
<span class='linenumber'>417</span>          }
<span class='linenumber'>418</span>        }
<span class='linenumber'>419</span>        a.push("]");
<span class='linenumber'>420</span>        return a.join("");
<span class='linenumber'>421</span>      },
<span class='linenumber'>422</span> 
<span class='linenumber'>423</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>424</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT"> </span><span class="NAME">Encode</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="NAME">date</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">json</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>425</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Date</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">date</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">encode</span><span class="WHIT">
<span class='linenumber'>426</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">String</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="NAME">encode</span><span class="WHIT"> </span><span class="NAME">as</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT">
<span class='linenumber'>427</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>428</span>      encodeDate : function(o){
<span class='linenumber'>429</span>        var pad = function(n) { return n &lt; 10 ? "0" + n : n; };
<span class='linenumber'>430</span>        return '"' + o.getFullYear() + "-" +
<span class='linenumber'>431</span>                pad(o.getMonth() + 1) + "-" +
<span class='linenumber'>432</span>                pad(o.getDate()) + "T" +
<span class='linenumber'>433</span>                pad(o.getHours()) + ":" +
<span class='linenumber'>434</span>                pad(o.getMinutes()) + ":" +
<span class='linenumber'>435</span>                pad(o.getSeconds()) + '"';
<span class='linenumber'>436</span>      },
<span class='linenumber'>437</span> 
<span class='linenumber'>438</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>439</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Customer</span><span class="WHIT"> </span><span class="NAME">encode</span><span class="WHIT"> </span><span class="NAME">decode</span><span class="WHIT"> </span><span class="NAME">and</span><span class="WHIT"> </span><span class="NAME">recode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">enabling</span><span class="WHIT"> </span><span class="NAME">reading</span><span class="WHIT"> </span><span class="NAME">and</span><span class="WHIT"> </span><span class="NAME">writing</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">JSON</span><span class="WHIT"> </span><span class="NAME">files</span><span class="WHIT"> </span><span class="KEYW">with</span><span class="WHIT"> </span><span class="NAME">javascript</span><span class="WHIT"> </span><span class="NAME">code</span><span class="WHIT">
<span class='linenumber'>440</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Object</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">encode</span><span class="WHIT">
<span class='linenumber'>441</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Int</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">indent</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">indent</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">uses</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">defaults</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>442</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">String</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="NAME">encode</span><span class="WHIT"> </span><span class="NAME">as</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT">
<span class='linenumber'>443</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/  
<span class='linenumber'>444</span>     encode : function(o,indent,keepJsonId,noLicense){       
<span class='linenumber'>445</span>        indent = indent || 0;
<span class='linenumber'>446</span>        if(typeof o == "undefined" || o === null){
<span class='linenumber'>447</span>            return "null";
<span class='linenumber'>448</span>        }else if(o instanceof Array){
<span class='linenumber'>449</span>            return this.encodeArray(o, indent,keepJsonId);
<span class='linenumber'>450</span>        }else if(o instanceof Date){
<span class='linenumber'>451</span>            return this.encodeDate(o);
<span class='linenumber'>452</span>        }else if(typeof o == "number"){
<span class='linenumber'>453</span>            return isFinite(o) ? String(o) : "null";
<span class='linenumber'>454</span>        }else if(typeof o == "string" && !isNaN(o) && o!='' ){
<span class='linenumber'>455</span>            return o; 
<span class='linenumber'>456</span>        } else if(typeof o == "string" && ['true','false'].indexOf(o)!=-1){
<span class='linenumber'>457</span>           return o;
<span class='linenumber'>458</span>        } else if(typeof o == "boolean") {
<span class='linenumber'>459</span>            return String(o);
<span class='linenumber'>460</span>        } else if(typeof o == "string"){
<span class='linenumber'>461</span>            return this.encodeString(o);
<span class='linenumber'>462</span>        }else {
<span class='linenumber'>463</span>         if (o.constructor) {
<span class='linenumber'>464</span>           var c = ""+o.constructor;
<span class='linenumber'>465</span>           c=c.substring(c.indexOf('function ')+9);
<span class='linenumber'>466</span>           c=c.substring(0,c.indexOf('(')).replace(' '); 
<span class='linenumber'>467</span>           if (!c) {
<span class='linenumber'>468</span>            b = ""+o.constructor;
<span class='linenumber'>469</span>            var b=b.substring(0,b.indexOf('.superclass'));
<span class='linenumber'>470</span>            for (var i=b.length-1;i>0;i--) {
<span class='linenumber'>471</span>              if ([';',' ','\n','\t'].indexOf(b.substring(i,i+1))!=-1) {
<span class='linenumber'>472</span>                c=b.substring(i+1);
<span class='linenumber'>473</span>                i=-1;
<span class='linenumber'>474</span>              }
<span class='linenumber'>475</span>            }
<span class='linenumber'>476</span>            if (c && o.initialConfig) {
<span class='linenumber'>477</span>              return this.indentStr(indent) + this.scriptStart 
<span class='linenumber'>478</span>                + 'new '+ c + '(' +
<span class='linenumber'>479</span>                 this.encode(o.initialConfig,indent+1,keepJsonId)
<span class='linenumber'>480</span>                + ') ' + this.scriptEnd;
<span class='linenumber'>481</span>            }
<span class='linenumber'>482</span>           } 
<span class='linenumber'>483</span>           if (['Array','Object','Date'].indexOf(c)== -1) { 
<span class='linenumber'>484</span>             return 'null /</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="WHIT"> </span><span class="STRN">' + c + '</span><span class="WHIT"> </span><span class="NAME">has</span><span class="WHIT"> </span><span class="NAME">no</span><span class="WHIT"> </span><span class="NAME">initialConfig</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="REGX">/';
<span class='linenumber'>485</span>           }
<span class='linenumber'>486</span>          }
<span class='linenumber'>487</span>          var a = [], b, i, v;
<span class='linenumber'>488</span>          if (indent==0 && this.licenseText && !noLicense) a.push(this.licenseText);
<span class='linenumber'>489</span>          a.push("{\n");
<span class='linenumber'>490</span>          for (i in o) {
<span class='linenumber'>491</span>            if (i.indexOf(this.jsonId)==0 && (!keepJsonId || i!=this.jsonId)) {
<span class='linenumber'>492</span>              var orgK = i.substring(this.jsonId.length);
<span class='linenumber'>493</span>              if (orgK && typeof(o[orgK])=='undefined') {
<span class='linenumber'>494</span>                 if(b) a.push(',\n'); 
<span class='linenumber'>495</span>                 a.push(this.indentStr(indent), orgK, " : ", this.scriptStart,o[i],this.scriptEnd);
<span class='linenumber'>496</span>                 b = true;
<span class='linenumber'>497</span>              }
<span class='linenumber'>498</span>              continue; /</span><span class="REGX">/internal id skip it during decode
<span class='linenumber'>499</span>            }
<span class='linenumber'>500</span>            if(!this.useHasOwn || o.hasOwnProperty(i)) {
<span class='linenumber'>501</span>              if (this.jsonId && o[this.jsonId + i]) {
<span class='linenumber'>502</span>                  if(b) a.push(',\n'); 
<span class='linenumber'>503</span>                  a.push(this.indentStr(indent), i, " : ", this.scriptStart,o[this.jsonId + i],this.scriptEnd);
<span class='linenumber'>504</span>                  b = true;
<span class='linenumber'>505</span>              } else {
<span class='linenumber'>506</span>                v = o[i];      
<span class='linenumber'>507</span>                switch (typeof v) {
<span class='linenumber'>508</span>                  case "function":
<span class='linenumber'>509</span>                    if(b) a.push(',\n'); 
<span class='linenumber'>510</span>                    a.push(this.indentStr(indent), i, " : ", this.scriptStart,""+v,this.scriptEnd);
<span class='linenumber'>511</span>                    b = true;
<span class='linenumber'>512</span>                    break;
<span class='linenumber'>513</span>                  case "undefined":
<span class='linenumber'>514</span>                  case "unknown":               
<span class='linenumber'>515</span>                      break;            
<span class='linenumber'>516</span>                  case "string" :
<span class='linenumber'>517</span>                     if (!v) break; /</span><span class="REGX">/Skip empty string
<span class='linenumber'>518</span>                  default:
<span class='linenumber'>519</span>                      if(b) a.push(',\n');
<span class='linenumber'>520</span>                      a.push(this.indentStr(indent), i, " : ",
<span class='linenumber'>521</span>                            v === null ? "null" : this.encode(v,indent + 1,keepJsonId));
<span class='linenumber'>522</span>                      b = true;
<span class='linenumber'>523</span>                }
<span class='linenumber'>524</span>              }
<span class='linenumber'>525</span>            }
<span class='linenumber'>526</span>          }
<span class='linenumber'>527</span>          a.push("\n" + this.indentStr(indent-1) + "}");
<span class='linenumber'>528</span>          return a.join("");
<span class='linenumber'>529</span>        }
<span class='linenumber'>530</span>      },
<span class='linenumber'>531</span> 
<span class='linenumber'>532</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>533</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Decode</span><span class="WHIT"> </span><span class="NAME">json</span><span class="WHIT"> </span><span class="NAME">evaluating</span><span class="WHIT"> </span><span class="NAME">Json</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">required_js</span><span class="PUNC">,</span><span class="NAME">required_css</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">returning</span><span class="WHIT"> </span><span class="NAME">all</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="WHIT"> </span><span class="NAME">as</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT">
<span class='linenumber'>534</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">String</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">decode</span><span class="WHIT">
<span class='linenumber'>535</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Object</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">decoded</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="KEYW">with</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT"> </span><span class="NAME">only</span><span class="WHIT">
<span class='linenumber'>536</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/     
<span class='linenumber'>537</span>      decodeAsString : function(json) {
<span class='linenumber'>538</span>        if (!json) return;
<span class='linenumber'>539</span>        /</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Encode</span><span class="WHIT"> </span><span class="NAME">all</span><span class="WHIT"> </span><span class="NAME">functions</span><span class="WHIT"> </span><span class="NAME">between</span><span class="WHIT"> </span><span class="NAME">begin</span><span class="WHIT"> </span><span class="NAME">and</span><span class="WHIT"> </span><span class="NAME">end</span><span class="WHIT"> </span><span class="NAME">as</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT"> </span><span class="NAME">enabling</span><span class="WHIT"> </span><span class="NAME">load</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">packages</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>540</span>        var value = json
<span class='linenumber'>541</span>        var v = '', s = value.indexOf(this.scriptStart);
<span class='linenumber'>542</span>        var jsonStr;
<span class='linenumber'>543</span>        while (s!=-1) {
<span class='linenumber'>544</span>          jsonStr = '';
<span class='linenumber'>545</span>          e = value.indexOf(this.scriptEnd,s);
<span class='linenumber'>546</span>          v += value.substring(0,s);
<span class='linenumber'>547</span>          if (this.jsonId) {
<span class='linenumber'>548</span>            var i = v.lastIndexOf(':')-1;
<span class='linenumber'>549</span>            while (i>0 && [" ","\t","\n","\r"].indexOf(v.substring(i,i+1))>=0) {i--;}
<span class='linenumber'>550</span>            var w = '';
<span class='linenumber'>551</span>            while (i>0 && [" ","\t","\n","\r","{","["].indexOf(v.substring(i,i+1))==-1) {
<span class='linenumber'>552</span>               w = v.substring(i,i+1) + w;
<span class='linenumber'>553</span>               i--;
<span class='linenumber'>554</span>            }
<span class='linenumber'>555</span>            jsonStr += ',' + this.jsonId + w + ' : ' + this.encodeString(value.substring(s+this.scriptStart.length,e));
<span class='linenumber'>556</span>         }            
<span class='linenumber'>557</span>          v += this.encodeString(value.substring(s+this.scriptStart.length,e)) + jsonStr;               
<span class='linenumber'>558</span>          value = value.substring(e+this.scriptEnd.length);
<span class='linenumber'>559</span>          s=value.indexOf(this.scriptStart);
<span class='linenumber'>560</span>        }
<span class='linenumber'>561</span>        v += value;   
<span class='linenumber'>562</span>        var scope = this.getJsonScope(); 
<span class='linenumber'>563</span>        var items = eval("(" + v + ")");
<span class='linenumber'>564</span>        if(items && items.json) { 
<span class='linenumber'>565</span>           items.json = eval("(" + items.json + ")");
<span class='linenumber'>566</span>           this.jsonInit(items.json,null,null,true);
<span class='linenumber'>567</span>        }
<span class='linenumber'>568</span>        
<span class='linenumber'>569</span>        /</span><span class="REGX">/When jsonId is set convert changed fields to jsonId+key=StringValue
<span class='linenumber'>570</span>        return items;
<span class='linenumber'>571</span>      },
<span class='linenumber'>572</span>      
<span class='linenumber'>573</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>574</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="WHIT"> </span><span class="NAME">returning</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">beused</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">json</span><span class="WHIT">
<span class='linenumber'>575</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Object</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>576</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>577</span>      getJsonScope : function(){
<span class='linenumber'>578</span>        return  this.jsonScope || this.scope || this;  
<span class='linenumber'>579</span>      },
<span class='linenumber'>580</span>      
<span class='linenumber'>581</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>582</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Decode</span><span class="WHIT"> </span><span class="NAME">json</span><span class="WHIT"> </span><span class="NAME">evaluating</span><span class="WHIT"> </span><span class="NAME">Json</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">required_js</span><span class="PUNC">,</span><span class="NAME">required_css</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>583</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">String</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">string</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">decode</span><span class="WHIT">
<span class='linenumber'>584</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Object</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">decoded</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT">
<span class='linenumber'>585</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>586</span>      decode : function(json) {
<span class='linenumber'>587</span>        var applyJsonId=function(o,j) {
<span class='linenumber'>588</span>          if (!this.jsonId) return o;
<span class='linenumber'>589</span>          for (var i in o) {
<span class='linenumber'>590</span>            if(!this.useHasOwn || o.hasOwnProperty(i)) {
<span class='linenumber'>591</span>             if (i=='items') {
<span class='linenumber'>592</span>               for (var k=0,len=o.items.length;k&lt;len;k++){
<span class='linenumber'>593</span>                  o.items[k] = applyJsonId(o.items[k],j.items[k]);
<span class='linenumber'>594</span>               }
<span class='linenumber'>595</span>             }
<span class='linenumber'>596</span>             else if (j[this.jsonId+i]) {
<span class='linenumber'>597</span>              o[this.jsonId+i] = j[this.jsonId+i];
<span class='linenumber'>598</span>             }
<span class='linenumber'>599</span>           }
<span class='linenumber'>600</span>          }
<span class='linenumber'>601</span>          return o;
<span class='linenumber'>602</span>        }.createDelegate(this);
<span class='linenumber'>603</span>        this.addJsonHistory(json);
<span class='linenumber'>604</span>        var items = this.decodeAsString(json);
<span class='linenumber'>605</span>        /</span><span class="REGX">/Now we can do decode by using eval setting scope
<span class='linenumber'>606</span>        var scope = this.getJsonScope();
<span class='linenumber'>607</span>        items = applyJsonId(eval("(" + json + ")"),items); 
<span class='linenumber'>608</span>        if(items) this.jsonInit(items.json); 
<span class='linenumber'>609</span>        return items;
<span class='linenumber'>610</span>      },
<span class='linenumber'>611</span> 
<span class='linenumber'>612</span>     /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>613</span> </span><span class="WHIT">     </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="WHIT"> </span><span class="NAME">used</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">clone</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT">
<span class='linenumber'>614</span> </span><span class="WHIT">     </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Object</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">be</span><span class="WHIT"> </span><span class="NAME">cloned</span><span class="WHIT">
<span class='linenumber'>615</span> </span><span class="WHIT">     </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Object</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">cloned</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT">
<span class='linenumber'>616</span> </span><span class="WHIT">     </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>617</span>     clone : function(o) {
<span class='linenumber'>618</span>       return this.decode(this.encode(o));
<span class='linenumber'>619</span>     }
<span class='linenumber'>620</span> });
<span class='linenumber'>621</span> 
<span class='linenumber'>622</span> Ext.ux.JSON = new Ext.ux.Json();
<span class='linenumber'>623</span> 
<span class='linenumber'>624</span> 
<span class='linenumber'>625</span> Ext.ux.JsonBasePanel = Ext.extend(Ext.Panel,new Ext.ux.Json);
<span class='linenumber'>626</span> 
<span class='linenumber'>627</span> 
<span class='linenumber'>628</span> /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>629</span> </span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Component</span><span class="WHIT"> </span><span class="NAME">extending</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="NAME">panel</span><span class="WHIT"> </span><span class="NAME">giving</span><span class="WHIT"> </span><span class="NAME">it</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">capability</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">read</span><span class="WHIT"> </span><span class="NAME">or</span><span class="WHIT"> </span><span class="NAME">create</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="NAME">JSON</span><span class="WHIT"> </span><span class="NAME">file.</span><span class="WHIT">
<span class='linenumber'>630</span> </span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">When</span><span class="WHIT"> </span><span class="NAME">using</span><span class="WHIT"> </span><span class="NAME">Json</span><span class="WHIT"> </span><span class="NAME">file</span><span class="WHIT"> </span><span class="NAME">created</span><span class="WHIT"> </span><span class="KEYW">with</span><span class="WHIT"> </span><span class="NAME">designer</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="NAME">JsonPanel</span><span class="WHIT"> </span><span class="NAME">will</span><span class="WHIT"> </span><span class="NAME">also</span><span class="WHIT"> </span><span class="NAME">evaluate</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">special</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>631</span> </span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">under</span><span class="WHIT"> </span><span class="NAME">Json</span><span class="WHIT"> </span><span class="NAME">root</span><span class="WHIT"> </span><span class="NAME">called</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="NAME">b</span><span class="PUNC">></span><span class="NAME">winbow</span><span class="PUNC">&lt;</span><span class="REGX">/b>. The JsonPanel currently evaluates two special window items 
<span class='linenumber'>632</span>  * called &lt;i>required_js,required_css&lt;/i</span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="NAME">enable</span><span class="WHIT"> </span><span class="NAME">loading</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">javascripts</span><span class="WHIT"> </span><span class="NAME">and</span><span class="WHIT"> </span><span class="NAME">stylesheets</span><span class="WHIT"> </span><span class="NAME">directly</span><span class="WHIT"> </span><span class="NAME">from</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">json.</span><span class="WHIT">
<span class='linenumber'>633</span> </span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>634</span> </span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">&lt;</span><span class="NAME">p</span><span class="PUNC">></span><span class="NAME">Example</span><span class="WHIT"> </span><span class="NAME">how</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">create</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="NAME">Json</span><span class="WHIT"> </span><span class="NAME">from</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="NAME">external</span><span class="WHIT"> </span><span class="NAME">file</span><span class="WHIT"> </span><span class="NAME">filling</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">browser</span><span class="PUNC">:</span><span class="PUNC">&lt;</span><span class="REGX">/p>
<span class='linenumber'>635</span>  * &lt;pre>&lt;code>new Ext.Viewport({
<span class='linenumber'>636</span>      items : new Ext.ux.JsonPanel({autoLoad:'json/</span><span class="NAME">designer.json</span><span class="STRN">'}),
<span class='linenumber'>637</span>      layout: '</span><span class="NAME">fit</span><span class="STRN">'
<span class='linenumber'>638</span>    }).show();&lt;/code>&lt;/pre>
<span class='linenumber'>639</span>  *&lt;p>Example how to (re)load a JsonPanel that is allready loaded:&lt;/p>
<span class='linenumber'>640</span>  * &lt;pre>&lt;code>this.load({url:'</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">url</span><span class="STRN">'});&lt;/code>&lt;/pre>   
<span class='linenumber'>641</span>  * &lt;p>&lt;b>IMPORTANT:&lt;/b>When you want use the JsonPanel to load a Json file in a local browser make sure that you include a
<span class='linenumber'>642</span>  * local xhr package like &lt;a href="http://extjs.com/forum/showthread.php?t=10672">localXHR&lt;/a> or any other
<span class='linenumber'>643</span>  * to fix the problem of ExtJs not supporting Ajax from local file system&lt;/p>
<span class='linenumber'>644</span>  * @type component
<span class='linenumber'>645</span>  */
<span class='linenumber'>646</span>  
<span class='linenumber'>647</span> Ext.ux.JsonPanel = Ext.extend(Ext.Panel,Ext.applyIf({
<span class='linenumber'>648</span>  
<span class='linenumber'>649</span>  //@private Layout is by default fit
<span class='linenumber'>650</span>  layout: '</span><span class="NAME">fit</span><span class="STRN">',
<span class='linenumber'>651</span>  
<span class='linenumber'>652</span>  //@private Border is by default false
<span class='linenumber'>653</span>  border: false,
<span class='linenumber'>654</span>  
<span class='linenumber'>655</span>  //@private Whe only read a JSON file once
<span class='linenumber'>656</span>  single:true,  //only needed once
<span class='linenumber'>657</span> 
<span class='linenumber'>658</span>   /**
<span class='linenumber'>659</span>    * Array with items which should be blocked during init
<span class='linenumber'>660</span>    * @type {Array}
<span class='linenumber'>661</span>    @cfg */
<span class='linenumber'>662</span>   blockedJsonInit : ['</span><span class="NAME">required_js</span><span class="STRN">','</span><span class="NAME">required_css</span><span class="STRN">','</span><span class="NAME">alignTo</span><span class="STRN">','</span><span class="NAME">anchorTo</span><span class="STRN">','</span><span class="NAME">items</span><span class="STRN">'],
<span class='linenumber'>663</span>     
<span class='linenumber'>664</span>  
<span class='linenumber'>665</span>  /**
<span class='linenumber'>666</span>   * @private Init the JSON Panel making sure caching is set depending on disableCaching 
<span class='linenumber'>667</span>   */
<span class='linenumber'>668</span>  initComponent : function(){
<span class='linenumber'>669</span>    if (this.autoLoad) {
<span class='linenumber'>670</span>      if (typeof this.autoLoad !== '</span><span class="NAME">object</span><span class="STRN">')  this.autoLoad = {url: this.autoLoad};
<span class='linenumber'>671</span>      if (typeof this.autoLoad['</span><span class="NAME">nocache</span><span class="STRN">'] == '</span><span class="NAME">undefined</span><span class="STRN">') this.autoLoad['</span><span class="NAME">nocache</span><span class="STRN">'] = this.disableCaching;
<span class='linenumber'>672</span>    }                
<span class='linenumber'>673</span>    Ext.ux.JsonPanel.superclass.initComponent.call(this);
<span class='linenumber'>674</span>    
<span class='linenumber'>675</span>    this.addEvents({
<span class='linenumber'>676</span>      /**
<span class='linenumber'>677</span>       * Fires after the jsonfile is retrived from server but before it'</span><span class="NAME">s</span><span class="WHIT"> </span><span class="NAME">loaded</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">panel</span><span class="WHIT">
<span class='linenumber'>678</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">event</span><span class="WHIT"> </span><span class="NAME">beforejsonload</span><span class="WHIT">
<span class='linenumber'>679</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Object</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">response</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">response</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="NAME">returned</span><span class="WHIT">
<span class='linenumber'>680</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Exception</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">exception</span><span class="WHIT"> </span><span class="NAME">when</span><span class="WHIT"> </span><span class="NAME">avialable</span><span class="WHIT">
<span class='linenumber'>681</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>682</span>     'beforejsonload' : true,
<span class='linenumber'>683</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>684</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Fires</span><span class="WHIT"> </span><span class="NAME">after</span><span class="WHIT"> </span><span class="NAME">panel</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">panel</span><span class="WHIT"> </span><span class="NAME">is</span><span class="WHIT"> </span><span class="NAME">loaded</span><span class="WHIT"> </span><span class="KEYW">with</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT">
<span class='linenumber'>685</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">event</span><span class="WHIT"> </span><span class="NAME">afterjsonload</span><span class="WHIT">
<span class='linenumber'>686</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>687</span>     'afterjsonload'  : true,
<span class='linenumber'>688</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>689</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Fires</span><span class="WHIT"> </span><span class="NAME">when</span><span class="WHIT"> </span><span class="NAME">loading</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">jsonfile</span><span class="WHIT"> </span><span class="NAME">fails</span><span class="WHIT">
<span class='linenumber'>690</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">event</span><span class="WHIT"> </span><span class="NAME">afterjsonload</span><span class="WHIT">
<span class='linenumber'>691</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>692</span>     'failedjsonload' : false
<span class='linenumber'>693</span>    });
<span class='linenumber'>694</span>  },
<span class='linenumber'>695</span> 
<span class='linenumber'>696</span> 
<span class='linenumber'>697</span>  /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>698</span> </span><span class="WHIT">  </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT"> </span><span class="NAME">We</span><span class="WHIT"> </span><span class="NAME">override</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">render</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">panel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">so</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">updater.renderer</span><span class="WHIT"> </span><span class="NAME">is</span><span class="WHIT"> </span><span class="NAME">changed</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">accept</span><span class="WHIT"> </span><span class="NAME">JSON</span><span class="WHIT">
<span class='linenumber'>699</span> </span><span class="WHIT">  </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Component</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">ct</span><span class="WHIT"> </span><span class="NAME">The</span><span class="WHIT"> </span><span class="NAME">component</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">render</span><span class="WHIT">
<span class='linenumber'>700</span> </span><span class="WHIT">  </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">Object</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">position</span><span class="WHIT"> </span><span class="NAME">A</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="NAME">containing</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">position</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">component</span><span class="WHIT">
<span class='linenumber'>701</span> </span><span class="WHIT">  </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>702</span>  onRender : function(ct, position){
<span class='linenumber'>703</span>   Ext.ux.JsonPanel.superclass.onRender.call(this, ct, position);
<span class='linenumber'>704</span>   var um = this.getUpdater();
<span class='linenumber'>705</span>   um.showLoadIndicator = false; /</span><span class="REGX">/disable it.
<span class='linenumber'>706</span>   um.on('failure',function(el, response){
<span class='linenumber'>707</span>     this.ownerCt.el.unmask();
<span class='linenumber'>708</span>     this.fireEvent('failedjsonload',response)
<span class='linenumber'>709</span>  }.createDelegate(this));
<span class='linenumber'>710</span>   um.setRenderer({render:
<span class='linenumber'>711</span>        function(el, response, updater, callback){
<span class='linenumber'>712</span>      /</span><span class="REGX">/add item configs to the panel layout
<span class='linenumber'>713</span>         /</span><span class="REGX">/Load the code to check if we should javascripts
<span class='linenumber'>714</span>         if (this.loadMask)
<span class='linenumber'>715</span>           this.ownerCt.el.mask(this.loadMsg, this.msgCls);
<span class='linenumber'>716</span>         this.fireEvent('beforejsonload', response);
<span class='linenumber'>717</span>         try { 
<span class='linenumber'>718</span>           this.applyJson(response.responseText);           
<span class='linenumber'>719</span>           this.fireEvent('afterjsonload');
<span class='linenumber'>720</span>           this.ownerCt.el.unmask();
<span class='linenumber'>721</span> 
<span class='linenumber'>722</span>           if(callback) {callback();}
<span class='linenumber'>723</span>         } catch (e) {
<span class='linenumber'>724</span>           this.ownerCt.el.unmask();
<span class='linenumber'>725</span>           if (!this.fireEvent('afterjsonload',response,e))
<span class='linenumber'>726</span>              Ext.Msg.alert('Failure','Failed to decode load Json:' + e)
<span class='linenumber'>727</span>         }
<span class='linenumber'>728</span>       }.createDelegate(this)
<span class='linenumber'>729</span>     });  
<span class='linenumber'>730</span>   }
<span class='linenumber'>731</span> 
<span class='linenumber'>732</span> },Ext.ux.JSON));
<span class='linenumber'>733</span> /</span><span class="REGX">/Register the panel
<span class='linenumber'>734</span> Ext.reg('jsonpanel', Ext.ux.JsonPanel);
<span class='linenumber'>735</span> 
<span class='linenumber'>736</span> 
<span class='linenumber'>737</span> /</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">FOR</span><span class="WHIT"> </span><span class="NAME">NOW</span><span class="WHIT"> </span><span class="NAME">WE</span><span class="WHIT"> </span><span class="NAME">COPY</span><span class="WHIT"> </span><span class="NAME">CODE</span><span class="WHIT"> </span><span class="NAME">TO</span><span class="WHIT"> </span><span class="NAME">ALSO</span><span class="WHIT"> </span><span class="NAME">HAVE</span><span class="WHIT"> </span><span class="NAME">A</span><span class="WHIT"> </span><span class="NAME">WINDOW</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">WE</span><span class="WHIT"> </span><span class="NAME">NEED</span><span class="WHIT"> </span><span class="NAME">TO</span><span class="WHIT"> </span><span class="NAME">FIND</span><span class="WHIT"> </span><span class="NAME">A</span><span class="WHIT"> </span><span class="NAME">SOLUTION</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>738</span> Ext.ux.JsonWindow = Ext.extend(Ext.Window,Ext.applyIf({
<span class='linenumber'>739</span> 
<span class='linenumber'>740</span>  /</span><span class="REGX">/@private Window is hidden by moving X out of screen
<span class='linenumber'>741</span>  x     : -1000,
<span class='linenumber'>742</span>  /</span><span class="REGX">/@private Window is hidden by moving Y out of screen
<span class='linenumber'>743</span>  y     : -1000,
<span class='linenumber'>744</span>  
<span class='linenumber'>745</span>  /</span><span class="REGX">/@private Layout is by default fit
<span class='linenumber'>746</span>  layout: 'fit',
<span class='linenumber'>747</span>  
<span class='linenumber'>748</span>  /</span><span class="REGX">/@private Border is by default false
<span class='linenumber'>749</span>  border: false,
<span class='linenumber'>750</span>  
<span class='linenumber'>751</span>  /</span><span class="REGX">/@private Whe only read a JSON file once
<span class='linenumber'>752</span>  single:true,  /</span><span class="REGX">/only needed once
<span class='linenumber'>753</span>  
<span class='linenumber'>754</span>  /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>755</span> </span><span class="WHIT">  </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT"> </span><span class="NAME">Init</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">JSON</span><span class="WHIT"> </span><span class="NAME">Panel</span><span class="WHIT"> </span><span class="NAME">making</span><span class="WHIT"> </span><span class="NAME">sure</span><span class="WHIT"> </span><span class="NAME">caching</span><span class="WHIT"> </span><span class="NAME">is</span><span class="WHIT"> </span><span class="NAME">set</span><span class="WHIT"> </span><span class="NAME">depending</span><span class="WHIT"> </span><span class="NAME">on</span><span class="WHIT"> </span><span class="NAME">disableCaching</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>756</span> </span><span class="WHIT">  </span><span class="PUNC">*</span><span class="REGX">/
<span class='linenumber'>757</span>  initComponent : function(){
<span class='linenumber'>758</span>    if (this.autoLoad) {
<span class='linenumber'>759</span>      if (typeof this.autoLoad !== 'object')  this.autoLoad = {url: this.autoLoad};
<span class='linenumber'>760</span>      if (typeof this.autoLoad['nocache'] == 'undefined') this.autoLoad['nocache'] = this.disableCaching;
<span class='linenumber'>761</span>    }                
<span class='linenumber'>762</span>    Ext.ux.JsonWindow.superclass.initComponent.call(this);
<span class='linenumber'>763</span>    
<span class='linenumber'>764</span>    this.addEvents({
<span class='linenumber'>765</span>      /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT">
<span class='linenumber'>766</span> </span><span class="WHIT">      </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Fires</span><span class="WHIT"> </span><span class="NAME">after</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">jsonfile</span><span class="WHIT"> </span><span class="NAME">is</span><span class="WHIT"> </span><span class="NAME">retrived</span><span class="WHIT"> </span><span class="NAME">from</span><span class="WHIT"> </span><span class="NAME">server</span><span class="WHIT"> </span><span class="NAME">but</span><span class="WHIT"> </span><span class="NAME">before</span><span class="WHIT"> </span><span class="NAME">it</span><span class="STRN">'s loaded in panel
<span class='linenumber'>767</span>       * @event beforejsonload
<span class='linenumber'>768</span>       * @param {Object} response The response object returned
<span class='linenumber'>769</span>       * @param {Exception} e The exception when avialable
<span class='linenumber'>770</span>       */
<span class='linenumber'>771</span>     '</span><span class="NAME">beforejsonload</span><span class="STRN">' : true,
<span class='linenumber'>772</span>      /**
<span class='linenumber'>773</span>       * Fires after panel the panel is loaded with new content
<span class='linenumber'>774</span>       * @event afterjsonload
<span class='linenumber'>775</span>       */
<span class='linenumber'>776</span>     '</span><span class="NAME">afterjsonload</span><span class="STRN">'  : true,
<span class='linenumber'>777</span>      /**
<span class='linenumber'>778</span>       * Fires when loading of jsonfile fails
<span class='linenumber'>779</span>       * @event afterjsonload
<span class='linenumber'>780</span>       */
<span class='linenumber'>781</span>     '</span><span class="NAME">failedjsonload</span><span class="STRN">' : false
<span class='linenumber'>782</span>    });
<span class='linenumber'>783</span>  },
<span class='linenumber'>784</span>  
<span class='linenumber'>785</span>  setX : function(x) {
<span class='linenumber'>786</span>    this.setPosition(x,this.y);
<span class='linenumber'>787</span>  },
<span class='linenumber'>788</span>  
<span class='linenumber'>789</span>  setY : function(y) {
<span class='linenumber'>790</span>     this.setPosition(this.x,y);
<span class='linenumber'>791</span>  },
<span class='linenumber'>792</span>  
<span class='linenumber'>793</span>  setAlignTo : function(arg) {
<span class='linenumber'>794</span>    this.alignTo(arg[0],arg[1],arg[2]);
<span class='linenumber'>795</span>  },
<span class='linenumber'>796</span>  
<span class='linenumber'>797</span>  setAnchorTo : function(ar) {
<span class='linenumber'>798</span>    this.anchorTo(arg[0],arg[1],arg[2],arg[3]);
<span class='linenumber'>799</span>  },
<span class='linenumber'>800</span>  
<span class='linenumber'>801</span>   
<span class='linenumber'>802</span>  /**
<span class='linenumber'>803</span>   * @private We override the render function of the panel, so that the updater.renderer is changed to accept JSON
<span class='linenumber'>804</span>   * @param {Component} ct The component to render
<span class='linenumber'>805</span>   * @param {Object} position A object containing the position of the component
<span class='linenumber'>806</span>   */
<span class='linenumber'>807</span>  onRender : function(ct, position){
<span class='linenumber'>808</span>   Ext.ux.JsonWindow.superclass.onRender.call(this, ct, position);
<span class='linenumber'>809</span>   var um = this.getUpdater();
<span class='linenumber'>810</span>   um.showLoadIndicator = false; //disable it.
<span class='linenumber'>811</span>   um.on('</span><span class="NAME">failure</span><span class="STRN">',function(el, response){this.fireEvent('</span><span class="NAME">failedjsonload</span><span class="STRN">',response)}.createDelegate(this));
<span class='linenumber'>812</span> 
<span class='linenumber'>813</span>   um.setRenderer({render:
<span class='linenumber'>814</span>        function(el, response, updater, callback){
<span class='linenumber'>815</span>      //add item configs to the panel layout
<span class='linenumber'>816</span>         //Load the code to check if we should javascripts
<span class='linenumber'>817</span>         this.fireEvent('</span><span class="NAME">beforejsonload</span><span class="STRN">', response);
<span class='linenumber'>818</span>         try { 
<span class='linenumber'>819</span>           this.applyJson(response.responseText); 
<span class='linenumber'>820</span>           this.fireEvent('</span><span class="NAME">afterjsonload</span><span class="STRN">');
<span class='linenumber'>821</span>           if(callback) {callback();}
<span class='linenumber'>822</span>         } catch (e) {
<span class='linenumber'>823</span>           if (!this.fireEvent('</span><span class="NAME">afterjsonload</span><span class="STRN">',response,e))
<span class='linenumber'>824</span>              Ext.Msg.alert('</span><span class="NAME">Failure</span><span class="STRN">','</span><span class="NAME">Failed</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="NAME">decode</span><span class="WHIT"> </span><span class="NAME">load</span><span class="WHIT"> </span><span class="NAME">Json</span><span class="PUNC">:</span><span class="STRN">' + e)
<span class='linenumber'>825</span>         }
<span class='linenumber'>826</span>       }.createDelegate(this)
<span class='linenumber'>827</span>     });  
<span class='linenumber'>828</span>   }
<span class='linenumber'>829</span> 
<span class='linenumber'>830</span> },Ext.ux.JSON));
<span class='linenumber'>831</span> 
<span class='linenumber'>832</span> //Register the window
<span class='linenumber'>833</span> Ext.reg('</span><span class="NAME">jsonwindow</span><span class="TOKN"></span></pre></body></html>